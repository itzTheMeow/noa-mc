/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var t,e={722:(t,e,n)=>{"use strict";n.d(e,{Qp:()=>p});var r=!1;if("undefined"!=typeof window){var i={get passive(){r=!0}};window.addEventListener("testPassive",null,i),window.removeEventListener("testPassive",null,i)}var o="undefined"!=typeof window&&window.navigator&&window.navigator.platform&&(/iP(ad|hone|od)/.test(window.navigator.platform)||"MacIntel"===window.navigator.platform&&window.navigator.maxTouchPoints>1),s=[],a=!1,c=-1,u=void 0,l=void 0,h=void 0,d=function(t){return s.some((function(e){return!(!e.options.allowTouchMove||!e.options.allowTouchMove(t))}))},f=function(t){var e=t||window.event;return!!d(e.target)||e.touches.length>1||(e.preventDefault&&e.preventDefault(),!1)},p=function(t,e){if(t){if(!s.some((function(e){return e.targetElement===t}))){var n={targetElement:t,options:e||{}};s=[].concat(function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(s),[n]),o?window.requestAnimationFrame((function(){if(void 0===l){l={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left};var t=window,e=t.scrollY,n=t.scrollX,r=t.innerHeight;document.body.style.position="fixed",document.body.style.top=-e,document.body.style.left=-n,setTimeout((function(){return window.requestAnimationFrame((function(){var t=r-window.innerHeight;t&&e>=r&&(document.body.style.top=-(e+t))}))}),300)}})):function(t){if(void 0===h){var e=!!t&&!0===t.reserveScrollBarGap,n=window.innerWidth-document.documentElement.clientWidth;if(e&&n>0){var r=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right"),10);h=document.body.style.paddingRight,document.body.style.paddingRight=r+n+"px"}}void 0===u&&(u=document.body.style.overflow,document.body.style.overflow="hidden")}(e),o&&(t.ontouchstart=function(t){1===t.targetTouches.length&&(c=t.targetTouches[0].clientY)},t.ontouchmove=function(e){1===e.targetTouches.length&&function(t,e){var n=t.targetTouches[0].clientY-c;!d(t.target)&&(e&&0===e.scrollTop&&n>0||function(t){return!!t&&t.scrollHeight-t.scrollTop<=t.clientHeight}(e)&&n<0?f(t):t.stopPropagation())}(e,t)},a||(document.addEventListener("touchmove",f,r?{passive:!1}:void 0),a=!0))}}else console.error("disableBodyScroll unsuccessful - targetElement must be provided when calling disableBodyScroll on IOS devices.")}},9312:(t,e,n)=>{"use strict";n.d(e,{ZT:()=>i,pi:()=>o,gn:()=>s,mG:()=>a,Jh:()=>c,pr:()=>u});var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function i(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o=function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function s(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s}function a(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))}function c(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function u(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}Object.create,Object.create},4407:(t,e,n)=>{"use strict";function r(t){return document.getElementById(t)}n.d(e,{Z:()=>an});var i=n(7729),o=n.n(i),s=n(4704),a=n.n(s),c=n(5602),u=n.n(c),l=n(4386),h=n.n(l),d=n(5984),f=n.n(d),p={preventDefaults:!1,stopPropagation:!1,allowContextMenu:!1},v={forward:["W","<up>"],left:["A","<left>"],backward:["S","<down>"],right:["D","<right>"],fire:"<mouse 1>","mid-fire":["<mouse 2>","Q"],"alt-fire":["<mouse 3>","E"],jump:"<space>",sprint:"<shift>",crouch:"<control>"};class m{constructor(t,e=10){this.stickyPointerLock=!1,this.stickyFullscreen=!1,this.tickRate=30,this.maxRenderRate=0,this.pointerLock=!1,this.fullscreen=!1,this.onTick=function(t){},this.onRender=function(){},this.onInit=function(){},this.onResize=function(){},this.onPointerLockChanged=function(t){},this.onFullscreenChanged=function(t){},_((()=>{!function(t,e){t._nowObject=performance||Date,t._lastTick=0,t._renderAccum=0,t._rt=0,t._frameCB=y.bind(null,t),requestAnimationFrame(t._frameCB),e>0&&(t._intervalCB=g.bind(null,t),t._interval=setInterval(t._intervalCB,e))}(this,e),function(t,e){if(e){var n=!1,r=!1;document.addEventListener("pointerlockchange",(r=>{n=document.pointerLockElement===e,t.onPointerLockChanged(n)})),document.addEventListener("fullscreenchange",(n=>{r=document.fullscreenElement===e,t.onFullscreenChanged(r)})),Object.defineProperty(t,"pointerLock",{get:()=>n,set:t=>{t&&!n?e.requestPointerLock():n&&!t&&document.exitPointerLock()}}),Object.defineProperty(t,"fullscreen",{get:()=>r,set:t=>{t&&!r?e.requestFullscreen():r&&!t&&document.exitFullscreen()}}),e.addEventListener("click",(i=>{t.stickyPointerLock&&!n&&e.requestPointerLock(),t.stickyFullscreen&&!r&&e.requestFullscreen()}));var i=()=>t.onResize();window.ResizeObserver?new ResizeObserver(i).observe(e):window.addEventListener("resize",i)}}(this,t),this.onInit()}))}}function g(t){var e=t._nowObject.now(),n=1e3/t.tickRate,r=t._lastTick+n;e<r||(t._lastTick=Math.max(e-n,r),t.onTick(n))}function y(t){requestAnimationFrame(t._frameCB),g(t);var e=t._nowObject.now(),n=e-t._rt;if(t._rt=e,t.maxRenderRate>0){t._renderAccum+=n;var r=1e3/t.maxRenderRate;if(t._renderAccum<r)return;t._renderAccum=Math.min(t._renderAccum-r,r)}var i=1e3/t.tickRate,o=(e-t._lastTick)/i;t.onRender(n,o,i)}var _=t=>{if("loading"===document.readyState){var e=()=>{document.removeEventListener("readystatechange",e),t()};document.addEventListener("readystatechange",e)}else setTimeout(t,1)};class b extends c.EventEmitter{constructor(t,e){var n,r,i;super(),e=e||{},this._noa=t,this.element=e.domElement||((n=document.createElement("div")).tabIndex=1,n.style.position="fixed",n.style.left="0px",n.style.right="0px",n.style.top="0px",n.style.bottom="0px",n.style.height="100%",n.style.overflow="hidden",document.body.appendChild(n),document.body.style.overflow="hidden",document.body.style.height="100%",n.id="noa-container",n),this.canvas=(r=this.element,(i=r.querySelector("canvas"))||((i=document.createElement("canvas")).style.position="absolute",i.style.left="0px",i.style.top="0px",i.style.height="100%",i.style.width="100%",i.id="noa-canvas",r.insertBefore(i,r.firstChild)),i),this._shell=new m(this.element,10),this._shell.tickRate=e.tickRate,this._shell.maxRenderRate=e.maxRenderRate,this._shell.stickyPointerLock=e.stickyPointerLock,this._shell.stickyFullscreen=e.stickyFullscreen,this.supportsPointerLock=!1,this.pointerInGame=!1,this.isFocused=!!document.hasFocus(),this.hasPointerLock=!1,this._shell.onTick=t.tick.bind(t),this._shell.onRender=t.render.bind(t),this._shell.onPointerLockChanged=t=>{this.hasPointerLock=t,this.emit(t?"gainedPointerLock":"lostPointerLock"),t&&(this.pointerInGame=!0)},this._shell.onInit=()=>{this._shell.onResize=t.rendering.resize.bind(t.rendering),function(t){if("pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document){t.supportsPointerLock=!0;var e=function(n){t.supportsPointerLock=!1,document.removeEventListener(n.type,e)};document.addEventListener("touchmove",e)}}(this),this.element.addEventListener("mouseenter",(()=>{this.pointerInGame=!0})),this.element.addEventListener("mouseleave",(()=>{this.pointerInGame=!1})),window.addEventListener("focus",(()=>{this.isFocused=!0})),window.addEventListener("blur",(()=>{this.isFocused=!1}));var e=()=>{this.pointerInGame=!0,this.isFocused=!0,this.element.removeEventListener("mousedown",e)};this.element.addEventListener("mousedown",e),this.emit("DOMready"),this._shell.onInit=null}}appendTo(t){this.element.appendChild(t)}setPointerLock(t=!1){this._shell.pointerLock=!!t}}var k=n(6133),w=n.n(k),x=n(59),M=n.n(x),C={inverseX:!1,inverseY:!1,sensitivityX:10,sensitivityY:10,initialZoom:0,zoomSpeed:.2},P=[o().create(),o().create(),o().create()],T=o().create();class D{constructor(t,e){this.noa=t,e=Object.assign({},C,e),this.sensitivityX=+e.sensitivityX,this.sensitivityY=+e.sensitivityY,this.inverseX=!!e.inverseX,this.inverseY=!!e.inverseY,this.heading=0,this.pitch=0,this.zoomDistance=e.initialZoom,this.zoomSpeed=e.zoomSpeed,this.cameraTarget=this.noa.ents.createEntity(["position"]);var n=.9*t.ents.getPositionData(t.playerEntity).height;t.ents.addComponent(this.cameraTarget,"followsEntity",{entity:t.playerEntity,offset:[0,n,0]}),this.currentZoom=e.initialZoom,this._currentZoom=this.currentZoom,Object.defineProperty(this,"currentZoom",{get:()=>this._currentZoom}),this._dirVector=o().fromValues(0,0,1)}_localGetTargetPosition(){var t=this.noa.ents.getPositionData(this.cameraTarget),e=P[0];return o().copy(e,t._renderPosition)}_localGetPosition(){var t=this._localGetTargetPosition();return 0===this._currentZoom?t:o().scaleAndAdd(t,t,this._dirVector,-this._currentZoom)}getTargetPosition(){var t=this._localGetTargetPosition(),e=P[1];return this.noa.localToGlobal(t,e)}getPosition(){var t=this._localGetPosition(),e=P[2];return this.noa.localToGlobal(t,e)}getDirection(){return this._dirVector}applyInputsToCamera(){var t=this.noa.inputs.state;!function(t){var e=t.dx,n=t.dy,r=Math.abs(e)>400&&Math.abs(e/A)>4,i=Math.abs(n)>400&&Math.abs(n/j)>4;r||i?(t.dx=A,t.dy=j,A=(A+e)/2,j=(j+n)/2):(A=e||1,j=n||1)}(t);var e=.0066*Math.PI/180,n=t.dy*this.sensitivityY*e,r=t.dx*this.sensitivityX*e;this.inverseY&&(n=-n),this.inverseX&&(r=-r);var i=2*Math.PI;this.heading+=r<0?r+i:r,this.heading>i&&(this.heading-=i);var s=Math.PI/2-.001;this.pitch=Math.max(-s,Math.min(s,this.pitch+n)),o().set(this._dirVector,0,0,1),console.log;var a=this._dirVector,c=T;o().rotateX(a,a,c,this.pitch),o().rotateY(a,a,c,this.heading)}updateBeforeEntityRenderSystems(){this._currentZoom+=(this.zoomDistance-this._currentZoom)*this.zoomSpeed}updateAfterEntityRenderSystems(){var t=function(t){t._sweepBox||(t._sweepBox=new(w())([0,0,0],[.2,.2,.2]),t._sweepGetVoxel=t.noa.world.getBlockSolidity.bind(t.noa.world),t._sweepVec=o().create(),t._sweepHit=()=>!0);var e=o().copy(t._sweepVec,t._localGetTargetPosition());o().add(e,e,t.noa.worldOriginOffset);for(var n=0;n<3;n++)e[n]-=.1;t._sweepBox.setPosition(e);var r=Math.max(t.zoomDistance,t.currentZoom)+.1;return o().scale(t._sweepVec,t.getDirection(),-r),M()(t._sweepGetVoxel,t._sweepBox,t._sweepVec,t._sweepHit,!0)}(this);this._currentZoom>t&&(this._currentZoom=t)}}var A=0,j=0,E=n(4542),I=n.n(E),L=n(7538),O=n(3706),S={shadowDistance:10};class B extends(I()){constructor(t,e){super(),this.noa=t,e=Object.assign({},S,e),this.names={};var r={shadow:e.shadowDistance},i=n(1791);for(var o of i.keys()){var s=/\.\/(.*)\.js/.exec(o)[1],a=r[s]||void 0,c=i(o);c.default&&(c=c.default);var u=c(t,a),l=this.createComponent(u);this.names[s]=l}this.hasPhysics=this.getComponentAccessor(this.names.physics),this.cameraSmoothed=this.getComponentAccessor(this.names.smoothCamera),this.hasPosition=this.getComponentAccessor(this.names.position),this.hasMesh=this.getComponentAccessor(this.names.mesh),this.getMeshData=this.getStateAccessor(this.names.mesh);var h=this.getStateAccessor(this.names.position);this.getPositionData=h,this.getPosition=t=>h(t).position;var d=this.getStateAccessor(this.names.physics);this.getPhysics=d,this.getPhysicsBody=t=>d(t).body,this.getMovement=this.getStateAccessor(this.names.movement),this.getCollideTerrain=this.getStateAccessor(this.names.collideTerrain),this.getCollideEntities=this.getStateAccessor(this.names.collideEntities),this.onPairwiseEntityCollision=function(t,e){}}setPosition(t,e,n=0,r=0){"number"==typeof e&&(e=[e,n,r]);var i=this.noa.globalToLocal(e,null,[]);this._localSetPosition(t,i)}setEntitySize(t,e,n,r){var i=this.getPositionData(t);i.width=(e+r)/2,i.height=n,this._updateDerivedPositionData(t,i)}_rebaseOrigin(t){for(var e of this.getStatesList(this.names.position)){var n=e._localPosition,r=e.width/2;F(n,0,-r,r,e.__id),F(n,1,0,e.height,e.__id),F(n,2,-r,r,e.__id),o().subtract(n,n,t),this._updateDerivedPositionData(e.__id,e)}}_localGetPosition(t){return this.getPositionData(t)._localPosition}_localSetPosition(t,e){var n=this.getPositionData(t);o().copy(n._localPosition,e),this._updateDerivedPositionData(t,n)}_updateDerivedPositionData(t,e){o().copy(e._renderPosition,e._localPosition);var n=this.noa.worldOriginOffset;o().add(e.position,e._localPosition,n),(0,L.updatePositionExtents)(e);var r=this.getPhysics(t);r&&(0,O.setPhysicsFromPosition)(r,e)}addComponentAgain(t,e,n){this.hasComponent(t,e)&&this.removeComponent(t,e),this.addComponent(t,e,n)}isTerrainBlocked(t,e,n){for(var r=this.noa.worldOriginOffset,i=Math.floor(t-r[0]),o=Math.floor(e-r[1]),s=Math.floor(n-r[2]),a=[i+.001,o+.001,s+.001,i+.999,o+.999,s+.999],c=this.getStatesList(this.names.collideTerrain),u=0;u<c.length;u++){var l=c[u].__id;if(R(a,this.getPositionData(l)._extents))return!0}return!1}getEntitiesInAABB(t,e){var n,r=this.noa.worldOriginOffset,i=[t.base[0]+r[0],t.base[1]+r[1],t.base[2]+r[2],t.max[0]+r[0],t.max[1]+r[1],t.max[2]+r[2]];if(e)for(var o of(n=[],this.getStatesList(e))){var s=this.getPositionData(o.__id);s&&n.push(s)}else n=this.getStatesList(this.names.position);for(var a=[],c=0;c<n.length;c++){var u=n[c];R(i,u._extents)&&a.push(u.__id)}return a}add(t,e,n,r,i,s,a){var c=this,u=this.createEntity();if(this.addComponent(u,this.names.position,{position:t||[0,0,0],width:e,height:n}),s){this.addComponent(u,this.names.physics);var l=this.getPhysics(u).body,h=this.names.smoothCamera;l.onStep=function(){c.addComponentAgain(u,h)}}return r&&(i||(i=o().create()),this.addComponent(u,this.names.mesh,{mesh:r,offset:i})),a&&this.addComponent(u,this.names.shadow,{size:e}),u}}function F(t,e,n,r,i){var o=t[e]+n,s=t[e]+r;Math.abs(o-Math.round(o))<.002&&(t[e]+=.002),Math.abs(s-Math.round(s))<.001&&(t[e]-=.001)}function R(t,e){return!(t[0]>e[3]||t[1]>e[4]||t[2]>e[5]||t[3]<e[0]||t[4]<e[1]||t[5]<e[2])}var z=n(7794),U=n(3229);n(2610);const N=function(t){this.rootNode=new U.Y("objectMeshRoot",t.rendering._scene);var e=[0,0,0],n=!1,r=new U.Y(""),i={},o=e=>{if(i[e])return i[e];var n=t.registry._blockMeshLookup[e];for(var r in i){var o=i[r].mesh;if(o===n||o.geometry===n.geometry)return i[e]=i[r]}return i[e]=new q(t,n)};this.initChunk=function(t){t._objectBlocks={}},this.setObjectBlock=function(n,i,s,a,c){var u=n.x+s,l=n.y+a,h=n.z+c,d=(0,z.wX)(u,l,h),f=n._objectBlocks[d]||0;if(f!==i){if(f>0&&o(f).removeInstance(n,d),i>0){var p=t.registry._blockHandlerLookup[i],v=p&&p.onCustomMeshCreate;v&&(r.position.copyFromFloats(.5,0,.5),r.scaling.setAll(1),r.rotation.setAll(0),v(r,u,l,h));var m=o(i),g=v?r:null;m.addInstance(n,d,s,a,c,g,e)}f>0&&!i&&delete n._objectBlocks[d],i>0&&(n._objectBlocks[d]=i)}},this.buildObjectMeshes=function(){for(var t in Z("start"),i){var e=i[t];e.updateMatrix(),0===e.count&&e.dispose(),e.disposed&&delete i[t]}Z("rebuilt"),Z("end")},this.disposeChunk=function(t){for(var e in t._objectBlocks){var r=t._objectBlocks[e];r>0&&o(r).removeInstance(t,e)}t._objectBlocks=null,n=!0},this.tick=function(){n&&(this.buildObjectMeshes(),n=!1)},this._rebaseOrigin=function(t){for(var r in e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],i)i[r].rebased=!1;for(var o in i){var s=i[o];if(!s.rebased){for(var a=0;a<s.count;a++){var c=a<<4;s.buffer[c+12]-=t[0],s.buffer[c+13]-=t[1],s.buffer[c+14]-=t[2]}s.rebased=!0,s.dirty=!0}}n=!0}};function q(t,e){this.mesh=e,this.buffer=null,this.capacity=0,this.count=0,this.dirty=!1,this.rebased=!0,this.disposed=!1,this.keyToIndex={},this.locToKey=[],this.mesh.position.setAll(0),this.mesh.parent=t._objectMesher.rootNode,t.rendering.addMeshToScene(this.mesh,!1),this.mesh.doNotSyncBoundingInfo=!0,this.mesh.alwaysSelectAsActiveMesh=!0}q.prototype.dispose=function(){this.disposed||(this.mesh.thinInstanceCount=0,this.setCapacity(0),this.mesh.isVisible=!1,this.mesh=null,this.keyToIndex=null,this.locToKey=null,this.disposed=!0)},q.prototype.addInstance=function(t,e,n,r,i,o,s){var a;this.count===this.capacity&&(a=this.capacity<16?16:2*this.capacity,this.setCapacity(a));var c=this.count<<4;if(this.locToKey[this.count]=e,this.keyToIndex[e]=c,o)o.position.x+=t.x-s[0]+n,o.position.y+=t.y-s[1]+r,o.position.z+=t.z-s[2]+i,o.resetLocalMatrix(),V(o._localMatrix._m,0,this.buffer,c);else{var u=H;u[12]=t.x-s[0]+n+.5,u[13]=t.y-s[1]+r,u[14]=t.z-s[2]+i+.5,V(u,0,this.buffer,c)}this.count++,this.dirty=!0},q.prototype.removeInstance=function(t,e){var n=this.keyToIndex[e];if(!(n>=0))throw"tried to remove object instance not in storage";delete this.keyToIndex[e];var r,i,o=n>>4,s=this.count-1;if(o!==s){var a=s<<4;V(this.buffer,a,this.buffer,n);var c=this.locToKey[s];this.keyToIndex[c]=n,this.locToKey[o]=c}this.count--,this.dirty=!0,this.count<.4*this.capacity&&((i=(r=this).capacity/2|0)<100||(r.setCapacity(i),r.locToKey.length=Math.max(r.locToKey.length,r.capacity)))},q.prototype.updateMatrix=function(){this.dirty&&(this.mesh.thinInstanceCount=this.count,this.mesh.thinInstanceBufferUpdated("matrix"),this.mesh.isVisible=this.count>0,this.dirty=!1)},q.prototype.setCapacity=function(t){if(this.capacity=t||0,t){var e=this.buffer;if(this.buffer=new Float32Array(16*this.capacity),e)for(var n=Math.min(e.length,this.buffer.length),r=0;r<n;r++)this.buffer[r]=e[r]}else this.buffer=null;this.mesh.thinInstanceSetBuffer("matrix",this.buffer),this.dirty=!1};var H=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function V(t,e,n,r){for(var i=0;i<16;i++)n[r+i]=t[e+i]}var Z=()=>{},K=n(8545),G=n(2613),Y=n(8151),X=n(7555),$=n(4551);const W=function(t){var e=new rt(t),n=new nt(t);this.initChunk=function(t){t._terrainMeshes=[]},this.meshChunk=function(r,i,o,s,c,u,l){it("start"),r._terrainMeshes.forEach((t=>t.dispose())),r._terrainMeshes.length=0,it("cleanup");var h=i||t.registry.getBlockFaceMaterial,d=o||t.registry._getMaterialVertexColor,f=void 0===c?t.rendering.useAO:c,p=u||t.rendering.aoVals,v=isNaN(l)?t.rendering.revAoVal:l,m=function(t){var e=t.voxels.shape[0],n=J;if(e+2!==n.shape[0]){var r=e+2;n=new(a())(new Uint16Array(r*r*r),[r,r,r]),J=n}var i=tt[0],o=tt[1],s=tt[2],c=tt[3],u=tt[4],l=tt[5],h=tt[6];e!==Q&&(Q=e,function(t,e,n,r){for(var i=0;i<3;i++)e[i]=[t-1,0,0][i],n[i]=[1,t,1][i],r[i]=[0,1,t+1][i]}(e,u,l,h));for(var d=0;d<3;d++){i[0]=d;for(var f=0;f<3;f++){i[1]=f;for(var p=0;p<3;p++){i[2]=p;for(var v=0;v<3;v++){var m=i[v];o[v]=u[m],s[v]=l[m],c[v]=h[m]}var g=t._neighbors.get(d-1,f-1,p-1),y=g?g.voxels:null;(0,z.Fx)(y,n,o,s,c)}}}return n}(r);it("copy");var g=r.isFull||r.isEmpty,y=e.mesh(m,h,d,f,p,v,g);it("geom");var _=0===y.numQuads?null:n.build(r,y,s);it("build"),it("end"),_&&_.getIndices().length>0&&(t.rendering.addMeshToScene(_,!0,r.pos,this),r._terrainMeshes.push(_))},this.disposeChunk=function(t){t._terrainMeshes.forEach((t=>t.dispose())),t._terrainMeshes.length=0}};var Q,J=new(a())(new Uint16Array(27),[3,3,3]),tt=Array.from(Array(10),(()=>[0,0,0])),et={numQuads:0,materialQuadCounts:{},quadMaterials:[1],positions:[.5],indices:[1],normals:[.5],colors:[.5],uvs:[.5],reset:function(){this.numQuads=0,this.materialQuadCounts={}}};function nt(t){function e(e){if(t.registry.getMaterialTexture(e))return!1;var n=t.registry.getMaterialData(e);return 1===n.alpha&&!n.renderMat}function n(t,e,n,r,i,o){for(var s=e*i,a=r*i,c=0;c<i;c++)n[a+c]=t[s+c]+o}function r(e,n){if(n||0==e)return t.rendering.flatMaterial;var r="terrain_mat:"+e;return i[r]||(i[r]=function(e,n){var r=t.registry.getMaterialData(e);if(r.renderMat)return r.renderMat;var i=t.registry.getMaterialTexture(e),o=r.alpha;if(!i&&1===o)return t.rendering.flatMaterial;var s=t.rendering.makeStandardMaterial(n);if(i){var a=t.rendering.getScene(),c=new $.x(i,a,!0,!1,$.x.NEAREST_SAMPLINGMODE);r.textureAlpha&&(c.hasAlpha=!0),s.diffuseTexture=c}return r.alpha<1&&(s.alpha=r.alpha),s}(e,r)),i[r]}this.build=function(i,o,s){var a=o.numQuads,c=o.materialQuadCounts,u={0:"0"};for(var l in c[0]=0,c)"0"!==l&&(s||e(l)?(c[0]+=c[l],c[l]=0,u[l]="0"):u[l]=l);var h={},d=0;for(var f in c)0!==c[f]&&(h[f]=d,d+=c[f]);for(var p=new Float32Array(12*a),v=new Uint16Array(6*a),m=new Float32Array(12*a),g=new Float32Array(16*a),y=new Float32Array(8*a),_=0;_<a;_++){var b=u[o.quadMaterials[_]],k=h[b],w=4*(k-_);n(o.positions,_,p,k,12,0),n(o.indices,_,v,k,6,w),n(o.normals,_,m,k,12,0),n(o.colors,_,g,k,16,0),n(o.uvs,_,y,k,8,0),h[b]++}var x=t.rendering.getScene(),M="chunk_"+i.requestID,C=new K.Kj(M,x),P=new Y.x;P.positions=p,P.indices=v,P.normals=m,P.colors=g,P.uvs=y,P.applyToMesh(C);var T=Object.keys(h).sort(((t,e)=>t<e?-1:1));if(1===T.length){var D=u[o.quadMaterials[0]];C.material=r(D,s)}else{C.subMeshes=[];var A=0;for(var j of T){var E=c[j],I=h[j]-E;new G.P(A,12*I,12*E,6*I,6*E,C),A++}C.material=function(t,e){var n="terrain_multi:"+t.join(","),i=new X.G("multimat "+n,e);return i.subMaterials=t.map((t=>r(t,!1))),i}(T,x)}return C};var i={}}function rt(t){var e=new Int16Array(16),n=new Uint16Array(16),r=t.registry._solidityLookup,i=t.registry._opacityLookup;function o(t,r,i,o,a,c){for(var u=i.shape[1],l=e,h=n,d=0,f=2*r,p=i.data,v=i.index(t-1,0,0),m=i.stride[0],y=i.stride[1],_=i.stride[2],b=0;b<u;++b){var k=v;v+=_;for(var w=0;w<u;w++,d++,k+=y){var x=p[k],M=p[k+m];if(x!==M){var C=s(x,M,o,f);C&&(l[d]=C>0?o(x,f):-o(M,f+1),a&&(h[d]=C>0?g(i,t,t-1,w,b,c):g(i,t-1,t,w,b,c)))}}}}function s(t,e,n,r){var o=i[t],s=i[e];if(o&&s)return 0;if(o)return 1;if(s)return-1;var a=n(t,r),c=n(e,r+1);return a===c?0:0===a?-1:0===c?1:0}function a(t,r,i,o,s,a,d,g,y,_,b){var k=0,w=e,x=n,M=[0,0,0],C=[0,0,0],P=[0,0,0];M[r]=t;for(var T=[0,0,0],D=d?f:p,A=d?m:v,j=0;j<a;++j)for(var E=1,I=1,L=0;L<s;L+=E,k+=E){var O=0|w[k];if(O){var S=0|x[k];for(E=1;E<s-L&&D(k+E,w,O,x,S);++E);t:for(I=1;I<a-j;++I)for(var B=0;B<E;++B)if(!D(k+B+I*s,w,O,x,S))break t;var F=Math.abs(O),R=g.numQuads;g.quadMaterials[R]=0|F,g.materialQuadCounts[F]=(g.materialQuadCounts[F]||0)+1;var z=A(g.colors,16*R,y(F),S,_,b);M[i]=L,M[o]=j,C[i]=E,P[o]=I,c(g.positions,12*R,M,C,P);var U=O>0?1:-1;u(g.uvs,8*R,r,E,I,U),T[r]=U,l(g.normals,12*R,T),h(g.indices,6*R,4*R,O,z),g.numQuads++;for(var N=0;N<I;++N)for(var q=0;q<E;++q)w[k+q+N*s]=0}else E=1}}function c(t,e,n,r,i){for(var o=0;o<3;o++)t[e+o]=n[o],t[e+3+o]=n[o]+r[o],t[e+6+o]=n[o]+r[o]+i[o],t[e+9+o]=n[o]+i[o]}function u(t,e,n,r,i,o){for(var s=0;s<8;s++)t[e+s]=0;2===n?(t[e+1]=t[e+3]=i,t[e+2]=t[e+4]=-o*r):(t[e+1]=t[e+7]=r,t[e+4]=t[e+6]=o*i)}function l(t,e,n){for(var r=0;r<12;r++)t[e+r]=n[r%3]}function h(t,e,n,r,i){for(var o=r<0?i?d.A:d.B:i?d.C:d.D,s=0;s<6;s++)t[e+s]=n+o[s]}this.mesh=function(s,c,u,l,h,d,f){r=t.registry._solidityLookup,i=t.registry._opacityLookup;var p=et;p.reset();for(var v=d===h[0],m=0;m<3;++m){var g=(m+1)%3,y=(m+2)%3,_=s.shape,b=s.transpose(m,g,y).lo(1,1,1).hi(_[m]-2,_[g]-2,_[y]-2),k=b.shape[0]-1,w=b.shape[1],x=b.shape[2];e.length<w*x&&(e=new Int16Array(w*x),n=new Uint16Array(w*x));for(var M=0;M<=k;++M)o(M,m,b,c,l,v),a(M,m,g,y,w,x,l,p,u,h,d),f&&(M+=k-1)}return p};var d={A:[0,1,2,0,2,3],B:[1,2,3,0,1,3],C:[0,2,1,0,3,2],D:[3,1,0,3,2,1]};function f(t,e,n,r,i){return n===e[t]&&i===r[t]}function p(t,e,n,r,i){return n===e[t]}function v(t,e,n,r,i,o){for(var s=0;s<16;s+=4)t[e+s]=n[0],t[e+s+1]=n[1],t[e+s+2]=n[2],t[e+s+3]=1;return!0}function m(t,e,n,r,i,o){var s=y(r,0,0),a=y(r,1,0),c=y(r,1,1),u=y(r,0,1);return _(t,e,n,s,i,o),_(t,e+4,n,a,i,o),_(t,e+8,n,c,i,o),_(t,e+12,n,u,i,o),s===c?u!==a||2===u:u!==a&&s+c>u+a}function g(t,e,n,i,o,s){var a=1,c=1,u=1,l=1;return r[t.get(e,i+1,o)]&&(++u,++l),r[t.get(e,i-1,o)]&&(++a,++c),r[t.get(e,i,o+1)]&&(++c,++l),r[t.get(e,i,o-1)]&&(++a,++u),r[t.get(e,i,o)]?(l=3===l||r[t.get(e,i+1,o+1)]?3:2,c=3===c||r[t.get(e,i-1,o+1)]?3:2,l<<6|(u=3===u||r[t.get(e,i+1,o-1)]?3:2)<<4|c<<2|(a=3===a||r[t.get(e,i-1,o-1)]?3:2)):s?(1===l&&r[t.get(e,i+1,o+1)]&&(l=2),1===c&&r[t.get(e,i-1,o+1)]&&(c=2),1===u&&r[t.get(e,i+1,o-1)]&&(u=2),1===a&&r[t.get(e,i-1,o-1)]&&(a=2),l<<6|u<<4|c<<2|a):(1===l&&(r[t.get(e,i+1,o+1)]?l=2:r[t.get(n,i,o+1)]&&r[t.get(n,i+1,o)]&&r[t.get(n,i+1,o+1)]||(l=0)),1===u&&(r[t.get(e,i+1,o-1)]?u=2:r[t.get(n,i,o-1)]&&r[t.get(n,i+1,o)]&&r[t.get(n,i+1,o-1)]||(u=0)),1===c&&(r[t.get(e,i-1,o+1)]?c=2:r[t.get(n,i,o+1)]&&r[t.get(n,i-1,o)]&&r[t.get(n,i-1,o+1)]||(c=0)),1===a&&(r[t.get(e,i-1,o-1)]?a=2:r[t.get(n,i,o-1)]&&r[t.get(n,i-1,o)]&&r[t.get(n,i-1,o-1)]||(a=0)),l<<6|u<<4|c<<2|a)}function y(t,e,n){return t>>(e?n?6:4:n?2:0)&3}function _(t,e,n,r,i,o){var s=0===r?o:i[r-1];t[e]=n[0]*s,t[e+1]=n[1]*s,t[e+2]=n[2]*s,t[e+3]=1}}var it=()=>{},ot={texturePath:""},st={solid:!0,opaque:!0,fluidDensity:1,viscosity:.5},at=[!1],ct=[!1],ut=[!1],lt=[!1],ht=[0,0,0,0,0,0],dt=[null],ft=[null],pt=[null],vt={},mt=[null];class gt{constructor(t,e){this.noa=t,e=Object.assign({},ot,e),this._texturePath=e.texturePath,this.registerBlock=function(t,e=null){e||(e={}),st.solid=!e.fluid,st.opaque=!e.fluid;var n=Object.assign({},st,e);if(t<1||t>65535)throw"Block id out of range: "+t;for(;t>at.length;)this.registerBlock(at.length,{});at[t]=!!n.solid,ct[t]=!!n.opaque,ut[t]=!!n.fluid,lt[t]=!!n.blockMesh,ft[t]=n.blockMesh||null;var r,i=n.material||null;if(i)if("string"==typeof i)r=[i,i,i,i,i,i];else if(i.length&&2==i.length)r=[i[1],i[1],i[0],i[0],i[1],i[1]];else if(i.length&&3==i.length)r=[i[2],i[2],i[0],i[1],i[2],i[2]];else{if(!i.length||6!=i.length)throw"Invalid material parameter: "+i;r=i}else r=[null,null,null,null,null,null];for(var o=0;o<6;++o)ht[6*t+o]=yt(this,vt,r[o],!0);dt[t]={},ut[t]&&(dt[t].fluidDensity=n.fluidDensity,dt[t].viscosity=n.viscosity);var s=n.onLoad||n.onUnload||n.onSet||n.onUnset||n.onCustomMeshCreate;return pt[t]=s?new _t(n):null,t},this.registerMaterial=function(t,e=[1,1,1],n="",r=!1,i=null){var o=vt[t]||mt.length;vt[t]=o;var s=1;return e&&4==e.length&&(s=e.pop()),mt[o]={color:e||[1,1,1],alpha:s,texture:n?this._texturePath+n:"",textureAlpha:!!r,renderMat:i||null},o},this.getBlockSolidity=function(t){return at[t]},this.getBlockOpacity=function(t){return ct[t]},this.getBlockFluidity=function(t){return ut[t]},this.getBlockProps=function(t){return dt[t]},this.getBlockFaceMaterial=function(t,e){return ht[6*t+e]},this.getMaterialColor=function(t){return mt[t].color},this.getMaterialTexture=function(t){return mt[t].texture},this.getMaterialData=function(t){return mt[t]},this._solidityLookup=at,this._opacityLookup=ct,this._fluidityLookup=ut,this._objectLookup=lt,this._blockMeshLookup=ft,this._blockHandlerLookup=pt,this._getMaterialVertexColor=function(t){return mt[t].texture?n:mt[t].color};var n=[1,1,1];this.registerMaterial("dirt",[.4,.3,0],null),this.registerBlock(1,{material:"dirt"})}}function yt(t,e,n,r){if(!n)return 0;var i=e[n];return void 0===i&&r&&(i=t.registerMaterial(n)),i}function _t(t){this.onLoad=t.onLoad||null,this.onUnload=t.onUnload||null,this.onSet=t.onSet||null,this.onUnset=t.onUnset||null,this.onCustomMeshCreate=t.onCustomMeshCreate||null}var bt=n(1480),kt=n(5836),wt=n(6884),xt=n(192);class Mt{constructor(t,e){var n=t._scene;n._addComponent(new xt.Zb(n));var r=new kt.V(o);n._selectionOctree=r,r.blocks=[];var i={};this.rebase=t=>{a(r,t)},this.includesMesh=t=>t._noaContainingBlock||t._noaIsDynamicContent,this.addMesh=(e,n,o,a)=>{if(!n)return e._noaIsDynamicContent=!0,void r.dynamicContent.push(e);var u=Math.floor(o[0]/s),l=Math.floor(o[1]/s),h=Math.floor(o[2]/s),d=(0,z.wX)(u,l,h),f=i[d];if(!f){var p=[u*s,l*s,h*s],v=[0,0,0];t.noa.globalToLocal(p,null,v),f=c(v,s),r.blocks.push(f),i[d]=f,f._noaMapKey=d}f.entries.push(e),e._noaContainingBlock=f,e.alwaysSelectAsActiveMesh=!0},this.removeMesh=t=>{if(t._noaIsDynamicContent&&(t._noaIsDynamicContent=null,(0,z.xP)(r.dynamicContent,t)),t._noaContainingBlock){t._noaContainingChunk=null;var e=t._noaContainingBlock;(0,z.xP)(e.entries,t),0===e.entries.length&&(delete i[e._noaMapKey],(0,z.xP)(r.blocks,e))}};var o=()=>{},s=e*t.noa.world.chunkSize,a=(t,e)=>{t.blocks.forEach((t=>{t.minPoint.subtractInPlace(e),t.maxPoint.subtractInPlace(e),t._boundingVectors.forEach((t=>t.subtractInPlace(e))),t.blocks&&a(t,e)}))},c=(t,e)=>{var n=new bt.P(t[0],t[1],t[2]),r=new bt.P(t[0]+e,t[1]+e,t[2]+e);return new wt.b(n,r,void 0,void 0,void 0,o)}}}var Ct=n(5525),Pt=n(2838),Tt=n(3665),Dt=n(2413),At=n(4466),jt=n(6149),Et=(n(5606),n(2638),n(7729)),It={showFPS:!1,antiAlias:!0,clearColor:[.8,.9,1],ambientColor:[1,1,1],lightDiffuse:[1,1,1],lightSpecular:[1,1,1],groundLightColor:[.5,.5,.5],useAO:!0,AOmultipliers:[.93,.8,.5],reverseAOmultiplier:1,preserveDrawingBuffer:!0,octreeBlockSize:2,renderOnResize:!0};class Lt{constructor(t,e,n){this.noa=t,e=Object.assign({},It,e),this.renderOnResize=!!e.renderOnResize,this.useAO=!!e.useAO,this.aoVals=e.AOmultipliers,this.revAoVal=e.reverseAOmultiplier,this.meshingCutoffTime=6,this._scene=null,this._engine=null,this._octree=null,this._octreeManager=null,function(t,e,n){t._engine=new Tt.D(e,n.antiAlias,{preserveDrawingBuffer:n.preserveDrawingBuffer}),t._scene=new Ct.x(t._engine);var r=t._scene;r.detachControl();var i=Math.round(n.octreeBlockSize);t._octreeManager=new Mt(t,i),t._cameraHolder=new U.Y("camHolder",r),t._camera=new Pt.c("camera",new bt.P(0,0,0),r),t._camera.parent=t._cameraHolder,t._camera.minZ=.01,t._cameraHolder.visibility=!1,t._camScreen=K.Kj.CreatePlane("camScreen",10,r),t.addMeshToScene(t._camScreen),t._camScreen.position.z=.1,t._camScreen.parent=t._camera,t._camScreenMat=t.makeStandardMaterial("camscreenmat"),t._camScreen.material=t._camScreenMat,t._camScreen.setEnabled(!1),t._camLocBlock=0;var o=new bt.P(.1,1,.3);function s(t){return new jt.Wo(t[0],t[1],t[2])}t._light=new Dt.e("light",o,r),r.clearColor=s(n.clearColor),r.ambientColor=s(n.ambientColor),t._light.diffuse=s(n.lightDiffuse),t._light.specular=s(n.lightSpecular),t._light.groundColor=s(n.groundLightColor),t.flatMaterial=t.makeStandardMaterial("flatmat")}(this,n,e),e.showFPS&&function(){var t=document.createElement("div");t.id="noa_fps",t.style.position="absolute",t.style.top="0",t.style.right="0",t.style.zIndex="0",t.style.color="white",t.style.backgroundColor="rgba(0,0,0,0.5)",t.style.font="14px monospace",t.style.textAlign="center",t.style.minWidth="2em",t.style.margin="4px",document.body.appendChild(t);var e=0,n=0,r=performance.now(),i=r;Bt=function(){e++;var o=performance.now();if(o-i>n&&(n=o-i),i=o,!(o-r<1e3)){var s=Math.round(e/(o-r)*1e3),a=Math.round(1/n*1e3);t.innerHTML=s+"<br>"+a,e=0,n=0,r=o}}}()}}Lt.prototype.getScene=function(){return this._scene},Lt.prototype.tick=function(t){},Lt.prototype.render=function(){St("start"),function(t){var e=t.noa.camera,n=e._localGetTargetPosition();t._cameraHolder.position.copyFromFloats(n[0],n[1],n[2]),t._cameraHolder.rotation.x=e.pitch,t._cameraHolder.rotation.y=e.heading,t._camera.position.z=-e.currentZoom;var r=e._localGetPosition(),i=t.noa.worldOriginOffset,o=Math.floor(r[0]+i[0]),s=Math.floor(r[1]+i[1]),a=Math.floor(r[2]+i[2]),c=t.noa.getBlock(o,s,a);!function(t,e){if(e!==t._camLocBlock){if(0===e)t._camScreen.setEnabled(!1);else{var n=t.noa.registry.getBlockFaceMaterial(e,0);if(n){var r=t.noa.registry.getMaterialData(n),i=r.color,o=r.alpha;i&&o&&o<1&&(t._camScreenMat.diffuseColor.set(0,0,0),t._camScreenMat.ambientColor.set(i[0],i[1],i[2]),t._camScreenMat.alpha=o,t._camScreen.setEnabled(!0))}}t._camLocBlock=e}}(t,c)}(this),St("updateCamera"),this._engine.beginFrame(),St("beginFrame"),this._scene.render(),St("render"),Bt(),this._engine.endFrame(),St("endFrame"),St("end")},Lt.prototype.postRender=function(){},Lt.prototype.resize=function(){this._engine.resize(),this.noa._paused&&this.renderOnResize&&this._scene.render()},Lt.prototype.highlightBlockFace=function(t,e,n){var r=function(t){var e=t._highlightMesh;if(!e){e=K.Kj.CreatePlane("highlight",1,t._scene);var n=t.makeStandardMaterial("highlightMat");n.backFaceCulling=!1,n.emissiveColor=new jt.Wo(1,1,1),n.alpha=.2,e.material=n;var r=.5,i=K.Kj.CreateLines("hightlightLines",[new bt.P(r,r,0),new bt.P(r,-r,0),new bt.P(-r,-r,0),new bt.P(-r,r,0),new bt.P(r,r,0)],t._scene);i.color=new jt.Wo(1,1,1),i.parent=e,t.addMeshToScene(e),t.addMeshToScene(i),t._highlightMesh=e}return e}(this);if(t){this.noa.globalToLocal(e,null,Ot);for(var i=.001+.001*Et.dist(this.noa.camera._localGetPosition(),Ot),o=0;o<3;o++)0===n[o]?Ot[o]+=.5:Ot[o]+=n[o]>0?1+i:-i;r.position.copyFromFloats(Ot[0],Ot[1],Ot[2]),r.rotation.x=n[1]?Math.PI/2:0,r.rotation.y=n[0]?Math.PI/2:0}r.setEnabled(t)};var Ot=[];Lt.prototype.addMeshToScene=function(t,e=!1,n=null,r=null){if(!this._octreeManager.includesMesh(t)){if(!t.parent){n||(n=[t.position.x,t.position.y,t.position.z]);var i=[];this.noa.globalToLocal(n,null,i),t.position.copyFromFloats(i[0],i[1],i[2])}e&&(t.freezeWorldMatrix(),t.freezeNormals&&t.freezeNormals()),this._octreeManager.addMesh(t,e,n,r),t.onDisposeObservable.add((()=>{this._octreeManager.removeMesh(t)}))}},Lt.prototype.makeStandardMaterial=function(t){var e=new At.K(t,this._scene);return e.specularColor.copyFromFloats(0,0,0),e.ambientColor.copyFromFloats(1,1,1),e.diffuseColor.copyFromFloats(1,1,1),this.postMaterialCreationHook(e),e},Lt.prototype.postMaterialCreationHook=function(t){},Lt.prototype.prepareChunkForRendering=function(t){},Lt.prototype.disposeChunkForRendering=function(t){},Lt.prototype._rebaseOrigin=function(t){var e=new bt.P(t[0],t[1],t[2]);this._scene.meshes.forEach((t=>{t.parent||(t.position.subtractInPlace(e),t._isWorldMatrixFrozen&&t.freezeWorldMatrix())})),this._octreeManager.rebase(e)},Lt.prototype.debug_SceneCheck=function(){var t=this._scene.meshes,e=this._octree.dynamicContent,n=[],r=0,i=0,o=this._scene.materials,s=[];o.forEach((t=>{t.subMaterials?t.subMaterials.forEach((t=>s.push(t))):s.push(t)})),this._octree.blocks.forEach((function(t){r++,t.entries.forEach((t=>n.push(t)))})),t.forEach((function(t){if(t._isDisposed&&u(t,"disposed mesh in scene"),!function(t){return 0===t.getIndices().length}(t))if(l(t,e,n)&&u(t,"non-empty mesh missing from octree"),t.material){i+=t.subMeshes?t.subMeshes.length:1;var r=t.material.subMaterials||[t.material];r.forEach((function(t){l(t,r)&&u(t,"mesh material not in scene")}))}else u(t,"non-empty scene mesh with no material")}));var a=[];s.forEach((e=>{var n=!1;t.forEach((t=>{t.material===e&&(n=!0),t.material&&t.material.subMaterials&&t.material.subMaterials.includes(e)&&(n=!0)})),n||a.push(e.name)})),a.length&&console.warn("Materials unused by any mesh: ",a.join(", ")),e.forEach((function(e){l(e,t)&&u(e,"octree/dynamic mesh not in scene")})),n.forEach((function(e){l(e,t)&&u(e,"octree block mesh not in scene")}));var c=Math.round(10*n.length/r)/10;function u(t,e){console.warn(t.name+" --- "+e)}function l(t,e,n){return!(!t||e.includes(t)||n&&n.includes(t))}return console.log("meshes - octree:",n.length,"  dynamic:",e.length,"   subMeshes:",i,"   avg meshes/octreeBlock:",c),"done."},Lt.prototype.debug_MeshCount=function(){var t={};for(var e in this._scene.meshes.forEach((e=>{var n=e.name||"";n=(n=(n=(n=n.replace(/-\d+.*/,"#")).replace(/\d+.*/,"#")).replace(/(rotHolder|camHolder|camScreen)/,"rendering use")).replace(/atlas sprite .*/,"atlas sprites"),t[n]=t[n]||0,t[n]++})),t)console.log("   "+(t[e]+"       ").substr(0,7)+e)};var St=()=>{},Bt=function(){},Ft=n(6133),Rt=n(7729),zt=n(59),Ut=n(6443),Nt={gravity:[0,-10,0],minBounceImpulse:.5,airDrag:.1,fluidDrag:.4,fluidDensity:2};function qt(t,e,n){t=Object.assign({},Nt,t),this.gravity=t.gravity,this.airDrag=t.airDrag,this.fluidDensity=t.fluidDensity,this.fluidDrag=t.fluidDrag,this.minBounceImpulse=t.minBounceImpulse,this.bodies=[],this.testSolid=e,this.testFluid=n}qt.prototype.addBody=function(t,e,n,r,i,o){t=t||new Ft([0,0,0],[1,1,1]),void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=0),void 0===i&&(i=1);var s=new Ut(t,e,n,r,i,o);return this.bodies.push(s),s},qt.prototype.removeBody=function(t){var e=this.bodies.indexOf(t);e<0||(this.bodies.splice(e,1),t.aabb=t.onCollide=null)};var Ht=Rt.create(),Vt=Rt.create(),Zt=Rt.create(),Kt=Rt.create(),Gt=Rt.create();qt.prototype.tick=function(t){t/=1e3;var e=ie(0,Rt.squaredLength(this.gravity));this.bodies.forEach((n=>function(t,e,n,r){if(Rt.copy(Gt,e.resting),e.mass<=0)return Rt.set(e.velocity,0,0,0),Rt.set(e._forces,0,0,0),void Rt.set(e._impulses,0,0,0);if(!function(t,e,n,r){if(e._sleepFrameCount>0)return!1;if(r)return!0;var i=!1,o=.5*n*n*e.gravityMultiplier;return Rt.scale(re,t.gravity,o),zt(t.testSolid,e.aabb,re,(function(){return i=!0,!0}),!0),i}(t,e,n,r||0===e.gravityMultiplier)){e._sleepFrameCount--,function(t,e){var n=e.aabb,r=Math.floor(n.base[0]),i=Math.floor(n.base[2]),o=Math.floor(n.base[1]),s=Math.floor(n.max[1]);if(!t.testFluid(r,o,i))return e.inFluid=!1,void(e.ratioInFluid=0);for(var a=1,c=o+1;c<=s&&t.testFluid(r,c,i);)a++,c++;var u=(o+a-n.base[1])/n.vec[1];u>1&&(u=1);var l=n.vec[0]*n.vec[1]*n.vec[2]*u,h=Yt;Rt.scale(h,t.gravity,-t.fluidDensity*l),e.applyForce(h),e.inFluid=!0,e.ratioInFluid=u}(t,e),se(e._forces),se(e._impulses),se(e.velocity),se(e.resting),Rt.scale(Ht,e._forces,1/e.mass),Rt.scaleAndAdd(Ht,Ht,t.gravity,e.gravityMultiplier),Rt.scale(Vt,e._impulses,1/e.mass),Rt.scaleAndAdd(Vt,Vt,Ht,n),Rt.add(e.velocity,e.velocity,Vt),e.friction&&(Xt(0,e,Vt),Xt(1,e,Vt),Xt(2,e,Vt));var i=e.airDrag>=0?e.airDrag:t.airDrag;e.inFluid&&(i=e.fluidDrag>=0?e.fluidDrag:t.fluidDrag,i*=1-(1-e.ratioInFluid)**2);var o=Math.max(1-i*n/e.mass,0);Rt.scale(e.velocity,e.velocity,o),Rt.scale(Zt,e.velocity,n),Rt.set(e._forces,0,0,0),Rt.set(e._impulses,0,0,0),e.autoStep&&oe(Qt,e.aabb),Wt(t,e.aabb,Zt,e.resting),e.autoStep&&function(t,e,n,r){if(!(e.resting[1]>=0)||e.inFluid){var i=0!==e.resting[0],o=0!==e.resting[2];if(i||o){var s=Math.abs(r[0]/r[2]);if((i||!(s>4))&&(o||!(s<1/4))){Rt.add(te,n.base,r);var a=t.testSolid;zt(a,n,r,(function(t,e,n,r){if(1!==e)return!0;r[e]=0}));var c=e.aabb.base[1],u=Math.floor(c+1.001)-c;Rt.set(ee,0,u,0);var l=!1;zt(a,n,ee,(function(t,e,n,r){return l=!0,!0})),l||(Rt.subtract(ne,te,n.base),ne[1]=0,Wt(t,n,ne,Jt),(!i||ie(n.base[0],te[0]))&&(o&&!ie(n.base[2],te[2])||(oe(e.aabb,n),e.resting[0]=Jt[0],e.resting[2]=Jt[2],e.onStep&&e.onStep())))}}}}(t,e,Qt,Zt);for(var s=0;s<3;++s)Kt[s]=0,e.resting[s]&&(Gt[s]||(Kt[s]=-e.velocity[s]),e.velocity[s]=0);var a=Rt.length(Kt);a>.001&&(Rt.scale(Kt,Kt,e.mass),e.onCollide&&e.onCollide(Kt),e.restitution>0&&a>t.minBounceImpulse&&(Rt.scale(Kt,Kt,e.restitution),e.applyImpulse(Kt))),Rt.squaredLength(e.velocity)>1e-5&&e._markActive()}}(this,n,t,e)))};var Yt=Rt.create();function Xt(t,e,n){var r=e.resting[t],i=n[t];if(0!==r&&!(r*i<=0)){Rt.copy($t,e.velocity),$t[t]=0;var o=Rt.length($t);if(!ie(o,0)){var s=Math.abs(e.friction*i),a=o>s?(o-s)/o:0;e.velocity[(t+1)%3]*=a,e.velocity[(t+2)%3]*=a}}}var $t=Rt.create();function Wt(t,e,n,r){return Rt.set(r,0,0,0),zt(t.testSolid,e,n,(function(t,e,n,i){r[e]=n,i[e]=0}))}var Qt=new Ft([],[]),Jt=Rt.create(),te=Rt.create(),ee=Rt.create(),ne=Rt.create(),re=Rt.create();function ie(t,e){return Math.abs(t-e)<1e-5}function oe(t,e){for(var n=0;n<3;n++)t.base[n]=e.base[n],t.max[n]=e.max[n],t.vec[n]=e.vec[n]}var se=function(t){},ae={gravity:[0,-10,0],airDrag:.1};class ce extends qt{constructor(t,e){e=Object.assign({},ae,e);var n=t.world,r=t.registry._solidityLookup,i=t.registry._fluidityLookup,o=t.worldOriginOffset;super(e,((t,e,i)=>{var s=n.getBlockID(t+o[0],e+o[1],i+o[2]);return r[s]}),((t,e,r)=>{var s=n.getBlockID(t+o[0],e+o[1],r+o[2]);return i[s]}))}}var ue=n(4704);const le=he;function he(t,e,n,r,i,o,s){this.noa=t,this.isDisposed=!1,this.requestID=e,this.voxels=s,this.i=n,this.j=r,this.k=i,this.size=o,this.x=n*o,this.y=r*o,this.z=i*o,this.pos=[this.x,this.y,this.z],this._terrainDirty=!1,this._objectsDirty=!1,t._terrainMesher.initChunk(this),t._objectMesher.initChunk(this),this.isFull=!1,this.isEmpty=!1;var a=Array.from(Array(27),(()=>null));this._neighbors=ue(a,[3,3,3]).lo(1,1,1),this._neighbors.set(0,0,0,this),this._neighborCount=0,this._timesMeshed=0,fe(this)}function de(t,e,n,r,i,o){var s=e[n];s&&s(t.x+r,t.y+i,t.z+o)}function fe(t){for(var e=!0,n=!0,r=t.voxels,i=r.data,o=r.shape[0],s=t.noa.registry._opacityLookup,a=t.noa.registry._blockHandlerLookup,c=t.noa.registry._objectLookup,u=t.noa._objectMesher,l=0;l<o;++l)for(var h=0;h<o;++h)for(var d=r.index(l,h,0),f=0;f<o;++f,++d){var p=i[d];if(0!==p){e=e&&s[p],n=!1,c[p]&&(u.setObjectBlock(t,p,l,h,f),t._objectsDirty=!0);var v=a[p];v&&de(t,v,"onLoad",l,h,f)}else e=!1}t.isFull=e,t.isEmpty=n,t._terrainDirty=!t.isEmpty}function pe(t,e){for(var n=t.voxels,r=n.data,i=t.noa.registry._blockHandlerLookup,o=n.shape[0],s=0;s<o;++s)for(var a=0;a<o;++a)for(var c=n.index(s,a,0),u=0;u<o;++u,++c){var l=r[c];l>0&&i[l]&&de(t,i[l],e,s,a,u)}}he._createVoxelArray=function(t){var e=new Uint16Array(t*t*t);return ue(e,[t,t,t])},he.prototype._updateVoxelArray=function(t){pe(this,"onUnload"),this.noa._objectMesher.disposeChunk(this),this.noa._terrainMesher.disposeChunk(this),this.voxels=t,this._terrainDirty=!1,this._objectsDirty=!1,this.noa._objectMesher.initChunk(this),this.noa._terrainMesher.initChunk(this),fe(this)},he.prototype.get=function(t,e,n){return this.voxels.get(t,e,n)},he.prototype.getSolidityAt=function(t,e,n){return this.noa.registry._solidityLookup[this.voxels.get(t,e,n)]},he.prototype.set=function(t,e,n,r){var i=this.voxels.get(t,e,n);if(r!==i){this.voxels.set(t,e,n,r);var o=this.noa.registry._solidityLookup,s=this.noa.registry._objectLookup,a=this.noa.registry._opacityLookup,c=this.noa.registry._blockHandlerLookup,u=c[i],l=c[r];u&&de(this,u,"onUnset",t,e,n),l&&de(this,l,"onSet",t,e,n);var h=this.noa._objectMesher,d=s[i],f=s[r];d&&h.setObjectBlock(this,0,t,e,n),f&&h.setObjectBlock(this,r,t,e,n),a[r]||(this.isFull=!1),0!==r&&(this.isEmpty=!1);var p=o[i]!==o[r],v=a[i]!==a[r];if((d||f)&&(this._objectsDirty=!0),(p||v||!f&&0!==r)&&(this._terrainDirty=!0),(this._terrainDirty||this._objectsDirty)&&this.noa.world._queueChunkForRemesh(this),p||v)for(var m=this.size-1,g=0===e?-1:0,y=0===n?-1:0,_=t===m?1:0,b=e===m?1:0,k=n===m?1:0,w=0===t?-1:0;w<=_;w++)for(var x=g;x<=b;x++)for(var M=y;M<=k;M++)if(0!=(w|x|M)){var C=this._neighbors.get(w,x,M);if(!C)return;C._terrainDirty=!0,this.noa.world._queueChunkForRemesh(C)}}},he.prototype.updateMeshes=function(){this._terrainDirty&&(this.noa._terrainMesher.meshChunk(this),this._timesMeshed++,this._terrainDirty=!1),this._objectsDirty&&(this.noa._objectMesher.buildObjectMeshes(),this._objectsDirty=!1)},he.prototype.dispose=function(){pe(this,"onUnload"),this.noa._objectMesher.disposeChunk(this),this.noa._terrainMesher.disposeChunk(this),this.voxels.data=null,this.voxels=null,this._neighbors.data=null,this._neighbors=null,this.isDisposed=!0};var ve={chunkSize:24,chunkAddDistance:[2,2],chunkRemoveDistance:[3,3],worldGenWhilePaused:!1,manuallyControlChunkLoading:!1};class me extends(u()){constructor(t,e){var n;super(),this.noa=t,e=Object.assign({},ve,e),this.playerChunkLoaded=!1,this.Chunk=le,this.chunkSize=e.chunkSize,this.chunkAddDistance=[1,1],this.chunkRemoveDistance=[1,1],this.setAddRemoveDistance(e.chunkAddDistance,e.chunkRemoveDistance),this.manuallyControlChunkLoading=!!e.manuallyControlChunkLoading,this.minNeighborsToMesh=6,this.maxChunksPendingCreation=10,this.maxChunksPendingMeshing=10,this.maxProcessingPerTick=9,this.maxProcessingPerRender=5,this.worldGenWhilePaused=e.worldGenWhilePaused,this._cachedWorldName="",this._lastPlayerChunkHash=0,this._chunkAddSearchDistance=0,this._chunksKnown=null,this._chunksPending=null,this._chunksToRequest=null,this._chunksToRemove=null,this._chunksToMesh=null,this._chunksToMeshFirst=null,(n=this)._chunksKnown=new z.l3,n._chunksToMesh=new z.l3,n._chunksPending=new z.l3,n._chunksToRemove=new z.l3,n._chunksToRequest=new z.l3,n._chunksToMeshFirst=new z.l3,this._storage=new z.dM;var r=this.chunkSize;this._coordsToChunkIndexes=we,this._coordsToChunkLocals=xe,0==(r&r-1)&&(this._coordShiftBits=0|Math.log2(r),this._coordMask=r-1|0,this._coordsToChunkIndexes=Me,this._coordsToChunkLocals=Ce)}}me.prototype.getBlockID=function(t,e,n){var[r,i,o]=this._coordsToChunkIndexes(t,e,n),s=this._storage.getChunkByIndexes(r,i,o);if(!s)return 0;var[a,c,u]=this._coordsToChunkLocals(t,e,n);return s.voxels.get(a,c,u)},me.prototype.getBlockSolidity=function(t,e,n){var[r,i,o]=this._coordsToChunkIndexes(t,e,n),s=this._storage.getChunkByIndexes(r,i,o);if(!s)return!1;var[a,c,u]=this._coordsToChunkLocals(t,e,n);return!!s.getSolidityAt(a,c,u)},me.prototype.getBlockOpacity=function(t,e,n){var r=this.getBlockID(t,e,n);return this.noa.registry.getBlockOpacity(r)},me.prototype.getBlockFluidity=function(t,e,n){var r=this.getBlockID(t,e,n);return this.noa.registry.getBlockFluidity(r)},me.prototype.getBlockProperties=function(t,e,n){var r=this.getBlockID(t,e,n);return this.noa.registry.getBlockProps(r)},me.prototype.setBlockID=function(t,e,n,r){var[i,o,s]=this._coordsToChunkIndexes(e,n,r),a=this._storage.getChunkByIndexes(i,o,s);if(a){var[c,u,l]=this._coordsToChunkLocals(e,n,r);return a.set(c,u,l,t,e,n,r)}},me.prototype.isBoxUnobstructed=function(t){for(var e=t.base,n=t.max,r=Math.floor(e[0]);r<n[0]+1;r++)for(var i=Math.floor(e[1]);i<n[1]+1;i++)for(var o=Math.floor(e[2]);o<n[2]+1;o++)if(this.getBlockSolidity(r,i,o))return!1;return!0},me.prototype.setChunkData=function(t,e,n){!function(t,e,n,r){var i=e.split("|"),o=parseInt(i.shift()),s=parseInt(i.shift()),a=parseInt(i.shift()),c=i.join("|");if(t._chunksPending.remove(o,s,a),c===t.noa.worldName&&t._chunksKnown.includes(o,s,a)&&!t._chunksToRemove.includes(o,s,a)){var u=t._storage.getChunkByIndexes(o,s,a);if(u)u._updateVoxelArray(n);else{var l=t.chunkSize;u=new le(t.noa,e,o,s,a,l,n),t._storage.storeChunkByIndexes(o,s,a,u),u.userData=r,t.noa.rendering.prepareChunkForRendering(u),t.emit("chunkAdded",u)}ke(t,u),Te(t,o,s,a,u),je("receive")}}(this,t,e,n)},me.prototype.setAddRemoveDistance=function(t=2,e=3){var n=Array.isArray(t)?t:[t,t],r=Array.isArray(e)?e:[e,e];r[0]<n[0]+1&&(r[0]=n[0]+1),r[1]<n[1]+1&&(r[1]=n[1]+1),this.chunkAddDistance=n,this.chunkRemoveDistance=r,this._chunkAddSearchDistance=0},me.prototype.invalidateVoxelsInAABB=function(t){!function(t,e){for(var n=t._coordsToChunkIndexes(e.base[0],e.base[1],e.base[2]),r=t._coordsToChunkIndexes(e.max[0],e.max[1],e.max[2]),i=0;i<3;i++)Number.isFinite(e.base[i])||(n[i]=e.base[i]),Number.isFinite(e.max[i])||(r[i]=e.max[i]);t._chunksKnown.forEach((e=>{for(var i=0;i<3;i++)if(e[i]<n[i]||e[i]>=r[i])return;t._chunksToRemove.add(e[0],e[1],e[2]),t._chunksToMesh.remove(e[0],e[1],e[2]),t._chunksToRequest.remove(e[0],e[1],e[2]),t._chunksToMeshFirst.remove(e[0],e[1],e[2])}))}(this,t)},me.prototype.manuallyLoadChunk=function(t,e,n){if(!this.manuallyControlChunkLoading)throw ge;var[r,i,o]=this._coordsToChunkIndexes(t,e,n);this._chunksKnown.add(r,i,o),this._chunksToRequest.add(r,i,o)},me.prototype.manuallyUnloadChunk=function(t,e,n){if(!this.manuallyControlChunkLoading)throw ge;var[r,i,o]=this._coordsToChunkIndexes(t,e,n);this._chunksToRemove.add(r,i,o),this._chunksToMesh.remove(r,i,o),this._chunksToRequest.remove(r,i,o),this._chunksToMeshFirst.remove(r,i,o)};var ge="Set `noa.world.manuallyControlChunkLoading` if you need this API";function ye(t){var e=t.noa.entities.getPosition(t.noa.playerEntity);return t._coordsToChunkIndexes(e[0],e[1],e[2])}me.prototype.tick=function(){var t=performance.now();this._cachedWorldName!==this.noa.worldName&&(function(t){t._chunksToRemove.copyFrom(t._chunksKnown),t._chunksToRequest.empty(),t._chunksToMesh.empty(),t._chunksToMeshFirst.empty();var e=ye(t);Pe(t._chunksToRemove,e[0],e[1],e[2])}(this),this._cachedWorldName=this.noa.worldName,this._chunkAddSearchDistance=0);var[e,n,r]=ye(this),i=(0,z.wX)(e,n,r),o=i!=this._lastPlayerChunkHash;o&&(this.emit("playerEnteredChunk",e,n,r),this._lastPlayerChunkHash=i,this._chunkAddSearchDistance=0),Ae("start"),je("start"),this.manuallyControlChunkLoading||(o&&(function(t,e,n,r){var i=t.chunkRemoveDistance[0],o=t.chunkRemoveDistance[1],s=i*i*2,a=i*i*2+o*o,c=t._chunksToRemove;t._chunksKnown.forEach((i=>{if(!c.includes(i[0],i[1],i[2])){var u=i[0]-e,l=i[1]-n,h=i[2]-r,d=u*u+h*h;Math.abs(l)<=o&&d<=s&&d+l*l<=a||(t._chunksToRemove.add(i[0],i[1],i[2]),t._chunksToMesh.remove(i[0],i[1],i[2]),t._chunksToRequest.remove(i[0],i[1],i[2]),t._chunksToMeshFirst.remove(i[0],i[1],i[2]))}})),Pe(c,e,n,r)}(this,e,n,r),Ae("remQueue")),function(t,e,n,r){var i=t._chunksToRequest;if(!(i.count()>50)){var o=Math.ceil(t.chunkAddDistance[0]),s=Math.ceil(t.chunkAddDistance[1]),a=Math.max(o,s);if(!(t._chunkAddSearchDistance>a)){for(var c=o*o*2+s*s,u=t._chunksKnown,l=t._chunksToRemove,h=Math.max(0,t._chunkAddSearchDistance),d=!1,f=!1;h<=a&&((0,z.fh)(h,o,s,((t,o,s)=>{var a=e+t,h=n+o,p=r+s;return u.includes(a,h,p)?(l.includes(a,h,p)&&(d=!0),!1):!(t*t+o*o+s*s>c)&&(u.add(a,h,p),i.add(a,h,p),i.count()>100?(f=!0,!0):void 0)})),!f);h++)d||(t._chunkAddSearchDistance=h+1);Pe(i,e,n,r)}}}(this,e,n,r),Ae("addQueue"));var s=Math.max(.5,this.maxProcessingPerTick);(0,z.KV)(s,(()=>{var t=function(t){var e=t._chunksToRequest;if(e.isEmpty())return!0;var n=t._chunksPending.count(),r=t._chunksToMesh.count();if(n>=t.maxChunksPendingCreation)return!0;if(r>=t.maxChunksPendingMeshing)return!0;var i=e.pop();return function(t,e,n,r){var i=t.chunkSize,o=le._createVoxelArray(t.chunkSize),s=t.noa.worldName,a=[e,n,r,s].join("|"),c=e*i,u=n*i,l=r*i;t._chunksPending.add(e,n,r),t.emit("worldDataNeeded",a,o,c,u,l,s),je("request")}(t,i[0],i[1],i[2]),e.isEmpty()}(this);return Ae("requests"),t=t&&function(t){var e=t._chunksToRemove;if(e.isEmpty())return!0;var n=e.pop();return function(t,e,n,r){var i=t._storage.getChunkByIndexes(e,n,r);i&&(t.emit("chunkBeingRemoved",i.requestID,i.voxels,i.userData),t.noa.rendering.disposeChunkForRendering(i),i.dispose(),je("dispose"),Te(t,e,n,r,null)),t._storage.removeChunkByIndexes(e,n,r),t._chunksKnown.remove(e,n,r),t._chunksToMesh.remove(e,n,r),t._chunksToMeshFirst.remove(e,n,r)}(t,n[0],n[1],n[2]),e.isEmpty()}(this),Ae("removes"),t=t&&be(this,!1),Ae("meshes"),t}),t),(s-=performance.now()-t)>.5&&(function(t){var e=t._chunksToMesh.count()+t._chunksToMeshFirst.count();if(!(e>5))for(var n=t._chunksKnown.arr,r=Math.min(50,n.length),i=0;i<r;i++){var o=n[_e=(_e+1)%n.length],s=t._storage.getChunkByIndexes(o[0],o[1],o[2]);if(s&&(ke(t,s)&&e++,e>5))return}}(this),Ae("looking"),(0,z.KV)(s,(()=>{var t=be(this,!1);return Ae("meshes"),t}),t));var a=this._storage.getChunkByIndexes(e,n,r);this.playerChunkLoaded=!!a,je("end",this),Ae("end")},me.prototype.render=function(){var t=this.maxProcessingPerRender;t>0&&(0,z.KV)(t,(()=>be(this,!0)))},me.prototype._getChunkByCoords=function(t,e,n){var[r,i,o]=this._coordsToChunkIndexes(t,e,n);return this._storage.getChunkByIndexes(r,i,o)},me.prototype._queueChunkForRemesh=function(t){ke(this,t)};var _e=-1;function be(t,e){var n=t._chunksToMeshFirst;if(n.isEmpty()&&!e&&(n=t._chunksToMesh),n.isEmpty())return!0;var r=n.pop();if(!t._chunksToRemove.includes(r[0],r[1],r[2])){var i=t._storage.getChunkByIndexes(r[0],r[1],r[2]);i&&function(t,e){t._chunksToMesh.remove(e.i,e.j,e.k),t._chunksToMeshFirst.remove(e.i,e.j,e.k),e.updateMeshes(),je("mesh")}(t,i)}}function ke(t,e){if(e._terrainDirty||e._objectsDirty){var n=e._neighborCount;if(!(n<e.minNeighborsToMesh))return(26===n?t._chunksToMeshFirst:t._chunksToMesh).add(e.i,e.j,e.k),!0}}function we(t,e,n){var r=this.chunkSize;return[0|Math.floor(t/r),0|Math.floor(e/r),0|Math.floor(n/r)]}function xe(t,e,n){var r=this.chunkSize,i=t%r|0;i<0&&(i+=r);var o=e%r|0;o<0&&(o+=r);var s=n%r|0;return s<0&&(s+=r),[i,o,s]}function Me(t,e,n){var r=this._coordShiftBits;return[t>>r|0,e>>r|0,n>>r|0]}function Ce(t,e,n){var r=this._coordMask;return[t&r|0,e&r|0,n&r|0]}function Pe(t,e,n,r){t.sortByDistance((t=>{var i=t[0]-e,o=t[1]-n,s=t[2]-r;return 10*(i*i+s*s)+Math.abs(o)}))}function Te(t,e,n,r,i){for(var o=!i||i&&!i.isEmpty,s=-1;s<=1;s++)for(var a=-1;a<=1;a++)for(var c=-1;c<=1;c++)if(0!=(s|a|c)){var u=t._storage.getChunkByIndexes(e+s,n+a,r+c);if(u){o&&(u._terrainDirty=!0),i&&!i._neighbors.get(s,a,c)&&(i._neighborCount++,i._neighbors.set(s,a,c,u));var l=u._neighbors.get(-s,-a,-c);i&&!l&&(u._neighborCount++,u._neighbors.set(-s,-a,-c,i),26===u._neighborCount&&ke(t,u)),!i&&l&&(u._neighborCount--,u._neighbors.set(-s,-a,-c,null))}}}function De(t,e,n,r){var i=0,o=0,s=0,a=0,c=[];n.forEach((e=>{var n=t._storage.getChunkByIndexes(e[0],e[1],e[2]);n&&(s++,c.push(n._timesMeshed),n.isFull&&i++,n.isEmpty&&o++,26===n._neighborCount&&a++)}));var u=n.length.toString().padEnd(8);if(u+=("exist: "+s).padEnd(12),u+=("full: "+i).padEnd(12),u+=("empty: "+o).padEnd(12),u+=("surr: "+a).padEnd(12),r){var l=c.reduce(((t,e)=>t+e),0),h=c.reduce(((t,e)=>Math.max(t,e)),0),d=c.reduce(((t,e)=>Math.min(t,e)),0);u+="times meshed: avg "+(l/s).toFixed(2),u+="  max "+h,u+="  min "+d}console.log(e,u)}me.prototype.report=function(){console.log("World report - playerChunkLoaded: ",this.playerChunkLoaded),De(this,"  known:     ",this._chunksKnown.arr,!0),De(this,"  to request:",this._chunksToRequest.arr,0),De(this,"  to remove: ",this._chunksToRemove.arr,0),De(this,"  creating:  ",this._chunksPending.arr,0),De(this,"  to mesh:   ",this._chunksToMesh.arr.concat(this._chunksToMeshFirst.arr),0)};var Ae=(0,z.hv)(0,"world ticks:",1),je=()=>{},Ee={debug:!1,silent:!1,playerHeight:1.8,playerWidth:.6,playerStart:[0,10,0],playerAutoStep:!1,tickRate:30,maxRenderRate:0,blockTestDistance:10,stickyPointerLock:!0,dragCameraOutsidePointerLock:!0,stickyFullscreen:!1,skipDefaultHighlighting:!1,originRebaseDistance:25};class Ie extends c.EventEmitter{constructor(t={}){if(super(),t=Object.assign({},Ee,t),this.version="0.30.0",!t.silent){var e=t.debug?" (debug)":"";console.log(`noa-engine v${this.version}${e}`)}this._paused=!1,this._dragOutsideLock=t.dragCameraOutsidePointerLock,this.worldOriginOffset=[0,0,0],this._originRebaseDistance=t.originRebaseDistance,this.positionInCurrentTick=0,this.worldName="default",this.container=new b(this,t),this.tickRate=this.container._shell.tickRate,Object.defineProperty(this,"tickRate",{get:()=>this.container._shell.tickRate}),this.maxRenderRate=this.container._shell.maxRenderRate,Object.defineProperty(this,"maxRenderRate",{get:()=>this.container._shell.maxRenderRate,set:t=>{this.container._shell.maxRenderRate=t||0}}),this.inputs=function(t,e,n){e=Object.assign({},p,e);var r=f()(n,e),i=e.bindings||v;for(var o in i){var s=Array.isArray(i[o])?i[o]:[i[o]];s.unshift(o),r.bind.apply(r,s)}return r}(0,t,this.container.element),this.registry=new gt(this,t),this.world=new me(this,t),this.rendering=new Lt(this,t,this.container.canvas),this.physics=new ce(this,t),this.entities=new B(this,t),this.ents=this.entities;var n=this.entities;this.playerEntity=n.add(t.playerStart,t.playerWidth,t.playerHeight,null,null,!0,!0),(n=this.ents).addComponent(this.playerEntity,n.names.collideTerrain),n.addComponent(this.playerEntity,n.names.collideEntities);var r=n.getPhysics(this.playerEntity).body;if(r.gravityMultiplier=2,r.autoStep=t.playerAutoStep,n.addComponent(this.playerEntity,n.names.receivesInputs),n.addComponent(this.playerEntity,n.names.fadeOnZoom),n.addComponent(this.playerEntity,n.names.movement,{airJumps:1}),this.camera=new D(this,t),this.blockTestDistance=t.blockTestDistance,this.blockTargetIdCheck=this.registry.getBlockSolidity,this.targetedBlock=null,t.skipDefaultHighlighting||(this.defaultBlockHighlightFunction=t=>{t?this.rendering.highlightBlockFace(!0,t.position,t.normal):this.rendering.highlightBlockFace(!1)},this.on("targetBlockChanged",this.defaultBlockHighlightFunction)),this._terrainMesher=new W(this),this._objectMesher=new N(this),this._targetedBlockDat={blockID:0,position:o().create(),normal:o().create(),adjacent:o().create()},this._prevTargetHash=0,this.makeTargetHash=(t,e,n)=>(0,z.wX)(t[0]+n,t[1],t[2])^(0,z.wX)(e[0],e[1]+n,e[2]),this._pickPos=o().create(),this._pickResult={_localPosition:o().create(),position:[0,0,0],normal:[0,0,0]},t.debug){this.vec3=o(),this.ndarray=a(),n.getMovement(1).airJumps=999;var i=window;i.noa=this,i.vec3=o(),i.ndarray=a(),i.scene=this.rendering._scene}!function(t){var e="0.27",n=(t,n,r)=>{var i=()=>{throw`This property changed in ${e} - ${r}`};Object.defineProperty(t,n,{get:i,set:i})};n(t,"getPlayerEyePosition","to get the camera/player offset see API docs for `noa.camera.cameraTarget`"),n(t,"setPlayerEyePosition","to set the camera/player offset see API docs for `noa.camera.cameraTarget`"),n(t,"getPlayerPosition","use `noa.ents.getPosition(noa.playerEntity)` or similar"),n(t,"getCameraVector","use `noa.camera.getDirection`"),n(t,"getPlayerMesh","use `noa.ents.getMeshData(noa.playerEntity).mesh` or similar"),n(t,"playerBody","use `noa.ents.getPhysicsBody(noa.playerEntity)`"),n(t.rendering,"zoomDistance","use `noa.camera.zoomDistance`"),n(t.rendering,"_currentZoom","use `noa.camera.currentZoom`"),n(t.rendering,"_cameraZoomSpeed","use `noa.camera.zoomSpeed`"),n(t.rendering,"getCameraVector","use `noa.camera.getDirection`"),n(t.rendering,"getCameraPosition","use `noa.camera.getLocalPosition`"),n(t.rendering,"getCameraRotation","use `noa.camera.heading` and `noa.camera.pitch`"),n(t.rendering,"setCameraRotation","to customize camera behavior see API docs for `noa.camera`"),e="0.28",n(t.rendering,"makeMeshInstance","removed, use Babylon's `mesh.createInstance`"),n(t.world,"_maxChunksPendingCreation",'use `maxChunksPendingCreation` (no "_")'),n(t.world,"_maxChunksPendingMeshing",'use `maxChunksPendingMeshing` (no "_")'),n(t.world,"_maxProcessingPerTick",'use `maxProcessingPerTick` (no "_")'),n(t.world,"_maxProcessingPerRender",'use `maxProcessingPerRender` (no "_")'),e="0.29",n(t,"_constants","removed, voxel IDs are no longer packed with bit flags"),e="0.30",n(t,"_tickRate","tickRate is now at `noa.tickRate`"),n(t.container,"_tickRate","tickRate is now at `noa.tickRate`")}(this)}tick(t){if(this._paused)this.world.worldGenWhilePaused&&this.world.tick();else if(Le("start"),function(t){var e=t.ents.getPositionData(t.playerEntity)._localPosition,n=t._originRebaseDistance;if(!(o().sqrLen(e)<n*n)){for(var r=[],i=0;i<3;i++)r[i]=Math.floor(e[i]),t.worldOriginOffset[i]+=r[i];t.rendering._rebaseOrigin(r),t.entities._rebaseOrigin(r),t._objectMesher._rebaseOrigin(r)}}(this),this.world.tick(),Le("world"),this.world.playerChunkLoaded){this.physics.tick(t),Le("physics"),this._objectMesher.tick(),this.rendering.tick(t),Le("rendering"),function(t){var e=0,n=t.blockTargetIdCheck||t.registry.getBlockSolidity,r=t._localPick(null,null,null,n);if(r){var i=t._targetedBlockDat;o().floor(i.adjacent,r.position),o().copy(i.normal,r.normal),o().subtract(i.position,i.adjacent,i.normal),i.blockID=t.world.getBlockID(i.position[0],i.position[1],i.position[2]),t.targetedBlock=i,e=t.makeTargetHash(i.position,i.normal,i.blockID,z.wX)}else t.targetedBlock=null;e!=t._prevTargetHash&&(t.emit("targetBlockChanged",t.targetedBlock),t._prevTargetHash=e)}(this),Le("targets"),this.entities.tick(t),Le("entities"),this.emit("tick",t),Le("tick event"),Le("end");var e=this.inputs.state;e.scrollx=e.scrolly=e.scrollz=0}else this.rendering.tick(t)}render(t,e){this.positionInCurrentTick=e,this._paused?this.world.worldGenWhilePaused&&this.world.render():(Oe("start"),(this.container.hasPointerLock||!this.container.supportsPointerLock||this._dragOutsideLock&&this.inputs.state.fire)&&this.camera.applyInputsToCamera(),Oe("init"),this.world.render(),Oe("meshing"),this.camera.updateBeforeEntityRenderSystems(),this.entities.render(t),this.camera.updateAfterEntityRenderSystems(),Oe("entities"),this.emit("beforeRender",t),Oe("before render"),this.rendering.render(),this.rendering.postRender(),Oe("render"),this.emit("afterRender",t),Oe("after render"),Oe("end"),this.inputs.state.dx=this.inputs.state.dy=0)}setPaused(t=!1){this._paused=!!t,t||(this.inputs.state.dx=this.inputs.state.dy=0)}getBlock(t,e=0,n=0){return t.length?this.world.getBlockID(t[0],t[1],t[2]):this.world.getBlockID(t,e,n)}setBlock(t,e,n=0,r=0){return e.length?this.world.setBlockID(e[0],e[1],e[2]):this.world.setBlockID(t,e,n,r)}addBlock(t,e,n=0,r=0){if(e.length){if(this.entities.isTerrainBlocked(e[0],e[1],e[2]))return;return this.world.setBlockID(t,e[0],e[1],e[2]),t}if(!this.entities.isTerrainBlocked(e,n,r))return this.world.setBlockID(t,e,n,r),t}globalToLocal(t,e,n){var r=this.worldOriginOffset;if(e){for(var i=0;i<3;i++){var s=t[i]-r[i];s+=e[i],n[i]=s}return n}return o().subtract(n,t,r)}localToGlobal(t,e,n=null){var r=this.worldOriginOffset;if(n){for(var i=0;i<3;i++){var s=Math.floor(t[i]);e[i]=s+r[i],n[i]=t[i]-s}return e}return o().add(e,t,r)}pick(t=null,e=null,n=-1,r=null){if(0===n)return null;var i=this._pickPos;return t&&(this.globalToLocal(t,null,i),t=i),this._localPick(t,e,n,r)}_localPick(t=null,e=null,n=-1,r=null){if(0===n)return null;var i=r||this.registry.getBlockSolidity,s=this.world,a=this.worldOriginOffset;t||(t=this.camera._localGetTargetPosition()),e=e||this.camera.getDirection(),(n=n||-1)<0&&(n=this.blockTestDistance);var c=this._pickResult,u=c._localPosition,l=c.normal;return h()((function(t,e,n){var r=s.getBlockID(t+a[0],e+a[1],n+a[2]);return i(r)}),t,e,n,u,l)?(o().scaleAndAdd(u,u,l,.01),this.localToGlobal(u,c.position),c):null}}n(7794).hv;var Le=()=>{},Oe=()=>{},Se=n(7315);let Be=1,Fe=[],Re=function(t,e,n){e.length||(e=[t]),n=Object.assign({},{transparent:!1,prev:e[0],flowerType:!1},n),e.forEach((t=>{Fe.includes(t)||(an.registry.registerMaterial(t,null,`img/blocks/${t}.png`,!0),Fe.push(t))})),this.id=Be,Be++,this.name=t,this.tex=e,this.preview=n.prev,this.transparent=n.transparent,this.flowerType=n.flowerType,this.getPreviewTex=function(){return 1==this.tex.length?[this.tex[0],this.tex[0],this.tex[0]]:2==this.tex.length?[this.tex[0],this.tex[1],this.tex[1]]:3==this.tex.length?[this.tex[0],this.tex[2],this.tex[2]]:[this.tex[3],this.tex[1],this.tex[5]]};let r={material:this.tex.length>1?this.tex:this.tex[0],opaque:!this.transparent};this.flowerType&&(r.blockMesh=function(t){let e=new Se.xEZ(`img/blocks/${t}.png`,an.rendering.getScene(),!0,!0,Se.xEZ.NEAREST_SAMPLINGMODE);e.hasAlpha=!0;const n=Se.Kj0.CreatePlane("xblock-"+t,1,an.rendering.getScene()),r=an.rendering.makeStandardMaterial(t);r.backFaceCulling=!1,r.diffuseTexture=e,r.diffuseTexture.vOffset=.99,n.material=r,n.rotation.y+=.81;const i=Se.y3G.Translation(0,.5,0);n.bakeTransformIntoVertices(i);const o=n.clone();return o.rotation.y+=1.62,Se.Kj0.MergeMeshes([n,o],!0)}(this.tex[0]),r.opaque=!1,r.solid=!1,delete r.material),an.registry.registerBlock(this.id,r)};function ze(t,e){return Math.floor(Math.random()*(e-t+1)+t)}n(2136);var Ue=Se.Pa4,Ne=Se.Wot;function qe(){this.position=Ue.Zero(),this.velocity=Ue.Zero(),this.size=1,this.age=0,this.lifetime=1}function He(t){t.position.copyFromFloats(0,0,0),t.velocity.x=5*(Math.random()-.5),t.velocity.y=.5*Math.random()*5+2,t.velocity.z=5*(Math.random()-.5),t.size=1*Math.random(),t.age=0,t.lifetime=2}function Ve(t,e,n,r,i,o){if(t||(t=100),isNaN(e)&&(e=0),!n)throw"Invalid scene passed to mesh-particle-system";r=r||{r:1,g:1,b:1,a:1},i=i||[0,1],o=o||[0,1],this.capacity=t,this.rate=e,this.mesh=new Se.Kj0("MPS-mesh",n),this.material=null,this.texture=null,this.gravity=-1,this.friction=1,this.fps=60,this.disposeOnEmpty=!1,this.stopOnEmpty=!1,this.onDispose=null,this.onParticleUpdate=function(){},this._scene=n,this._alive=0,this._data=new Float32Array(t*Ke),this._dummyParticle=new qe,this._color0=new Se.HEv(r.r,r.g,r.b,r.a),this._color1=new Se.HEv(r.r,r.g,r.b,r.a),this._updateColors=!1,this._size0=1,this._size1=1,this._positions=[],this._colors=[],this._playing=!1,this._disposed=!1,this._lastPos=Ue.Zero(),this._startingThisFrame=!1,this._toEmit=0,this._createdOwnMaterial=!1,this._needsColorUpdate=!0;for(var s=this._positions,a=this._colors,c=[],u=[],l=[i[0],o[1],i[1],o[1],i[1],o[0],i[0],o[0]],h=0;h<t;h++){s.push(0,0,0,0,0,0,0,0,0,0,0,0),c.push(4*h,4*h+1,4*h+2),c.push(4*h,4*h+2,4*h+3);for(var d=0;d<8;d++)u.push(l[d]);for(var f=0;f<4;f++)a.push(r.r,r.g,r.b,r.a)}var p=new Se.xx8;p.positions=s,p.indices=c,p.uvs=u,p.colors=a,p.applyToMesh(this.mesh,!0),this.initParticle=He;var v=this;this.curriedAnimate=function(){v.animate(1/v.fps)}}var Ze=Ve;Ze.prototype.start=function(){if(!this._playing){if(this._disposed)throw new Error("Already disposed");this._scene.registerBeforeRender(this.curriedAnimate),function(t){for(var e=t._dummyParticle,n=0,r=new Ue(1/0,1/0,1/0),i=new Ue(-1/0,-1/0,-1/0),o=t.gravity/2,s=0;s<30;++s){t.initParticle(e),Ye(r,i,e.position.x,e.position.y,e.position.z);var a=e.lifetime;Ye(r,i,e.position.x+a*e.velocity.x,e.position.y+a*e.velocity.y+a*a*o,e.position.z+a*e.velocity.z),n=Math.max(n,e.size)}r.subtractFromFloatsToRef(n,n,n,r),i.subtractFromFloatsToRef(-n,-n,-n,i),t.mesh._boundingInfo=new Se.jF4(r,i)}(this),this._playing=!0,this._startingThisFrame=!0}},Ze.prototype.stop=function(){this._playing&&(this._scene.unregisterBeforeRender(this.curriedAnimate),this._playing=!1)},Ze.prototype.setTexture=function(t,e){e?(this.material&&this._createdOwnMaterial&&this.material.dispose(!1,!1),this.material=e,this._createdOwnMaterial=!1):this.material||(this.material=new Se.KuD("MPS-mat",this._scene),this.material.specularColor=Ne.Black(),this.material.checkReadyOnlyOnce=!0,this._createdOwnMaterial=!0),this.mesh.material=this.material,this.texture=t,this._needsColorUpdate=!0},Ze.prototype.setAlphaRange=function(t,e){this._color0.a=t,this._color1.a=e,this._needsColorUpdate=!0},Ze.prototype.setColorRange=function(t,e){this._color0.r=t.r,this._color0.g=t.g,this._color0.b=t.b,this._color1.r=e.r,this._color1.g=e.g,this._color1.b=e.b,this._needsColorUpdate=!0},Ze.prototype.setSizeRange=function(t,e){this._size0=t,this._size1=e},Ze.prototype.setMeshPosition=function(t,e,n){!function(t,e,n,r){if(t._lastPos.copyFrom(t.mesh.position),!(Math.abs(e)+Math.abs(n)+Math.abs(r)<.001))for(var i=t._data,o=t._alive*Ke,s=0;s<o;s+=Ke)i[s]-=e,i[s+1]-=n,i[s+2]-=r}(this,t-this.mesh.position.x,e-this.mesh.position.y,n-this.mesh.position.z),this.mesh.position.copyFromFloats(t,e,n)},Ze.prototype.emit=function(t){this.start(),this._toEmit+=t},Ze.prototype.dispose=function(){var t;this.onDispose&&this.onDispose(),(t=this).stop(),t._createdOwnMaterial&&(t.material.ambientTexture=null,t.material.opacityTexture=null,t.material.diffuseTexture=null,t.material.dispose(!1,!1)),t.material=null,t.mesh.geometry.dispose(),t.mesh.dispose(),t.mesh=null,t.texture=null,t.curriedAnimate=null,t.initParticle=null,t._scene=null,t._dummyParticle=null,t._color0=null,t._color1=null,t._data=null,t._positions.length=0,t._colors.length=0,t._positions=null,t._colors=null,t._disposed=!0};var Ke=9;function Ge(t,e){return Math.abs(t-e)<1e-5}function Ye(t,e,n,r,i){n<t.x?t.x=n:n>e.x&&(e.x=n),r<t.y?t.y=r:r>e.y&&(e.y=r),i<t.z?t.z=i:i>e.z&&(e.z=i)}function Xe(t){var e=t._dummyParticle;t.initParticle(e);var n=t._data,r=t._alive*Ke;n[r]=e.position.x,n[r+1]=e.position.y,n[r+2]=e.position.z,n[r+3]=e.velocity.x,n[r+4]=e.velocity.y,n[r+5]=e.velocity.z,n[r+6]=e.size,n[r+7]=e.age,n[r+8]=e.lifetime,t._alive+=1}function $e(t,e){for(var n=t._data,r=(t._alive-1)*Ke,i=e*Ke,o=0;o<Ke;++o)n[i+o]=n[r+o];t._alive-=1}Ze.prototype.animate=function(t){en("start"),t>.1&&(t=.1),this._needsColorUpdate&&function(t){t._needsColorUpdate=!1;var e=t._color0,n=t._color1,r=!(Ge(e.a,1)&&Ge(e.a,n.a)),i=!(Ge(e.r,n.r)&&Ge(e.g,n.g)&&Ge(e.b,n.b));t._updateColors=r||i,t.mesh.hasVertexAlpha=r,t.material&&(i||r?(t.material.diffuseTexture=null,t.material.ambientTexture=t.texture,t.material.opacityTexture=t.texture,t.material.diffuseColor=Ne.White(),t.material.useAlphaFromDiffuseTexture=!0,t.texture&&(t.texture.hasAlpha=!1)):(t.material.diffuseTexture=t.texture,t.material.ambientTexture=null,t.material.opacityTexture=null,t.material.diffuseColor=new Ne(e.r,e.g,e.b),t.material.useAlphaFromDiffuseTexture=!1,t.texture&&(t.texture.hasAlpha=!0)))}(this),en("init"),function(t,e){t._toEmit+=e;var n=Math.floor(t._toEmit);t._toEmit-=n;var r=t._alive+n;for(r>t.capacity&&(r=t.capacity);t._alive<r;)Xe(t)}(this,this.rate*t),function(t,e){for(var n=+e,r=+t.gravity*n,i=+t.friction,o=t._data,s=t.onParticleUpdate,a=t._alive*Ke,c=0;c<a;c+=Ke)o[c+4]+=r,o[c+3]*=i,o[c+4]*=i,o[c+5]*=i,o[c]+=o[c+3]*n,o[c+1]+=o[c+4]*n,o[c+2]+=o[c+5]*n,o[c+7]+=n,s(o,c),o[c+7]>o[c+8]&&($e(t,c/Ke|0),c-=Ke,a=t._alive*Ke)}(this,t),en("update"),function(t){var e=t._positions,n=t._data,r=t._scene.activeCamera,i=We;Se.y3G.IdentityToRef(i),Se.y3G.LookAtLHToRef(r.globalPosition,t.mesh.position,Ue.Up(),i),i.m[12]=i.m[13]=i.m[14]=0;var o=Qe;i.invertToRef(o);for(var s=o.m,a=t._size0,c=t._size1-a,u=0,l=t._alive*Ke,h=0;h<l;h+=Ke)for(var d=n[h+6]*(a+c*n[h+7]/n[h+8])/2,f=0;f<4;f++){var p=d*Je[f],v=d*tn[f],m=p*s[3]+v*s[7]+s[15];let t=Math.max(0,n[h+1]);t||(n[h+3]=n[h+4]=n[h+5]=0),e[u]=n[h]+(p*s[0]+v*s[4])/m,e[u+1]=t+(p*s[1]+v*s[5])/m,e[u+2]=n[h+2]+(p*s[2]+v*s[6])/m,u+=3}t.mesh.updateVerticesData(Se.oZy.PositionKind,e,!1,!1)}(this),en("positions"),this._updateColors&&function(t){for(var e=t._alive,n=t._data,r=t._colors,i=t._color0.r,o=t._color0.g,s=t._color0.b,a=t._color0.a,c=t._color1.r-i,u=t._color1.g-o,l=t._color1.b-s,h=t._color1.a-a,d=0,f=0,p=0;p<e;p++){for(var v=n[d+7]/n[d+8],m=i+c*v,g=o+u*v,y=s+l*v,_=a+h*v,b=0;b<4;b++)r[f]=m,r[f+1]=g,r[f+2]=y,r[f+3]=_,f+=4;d+=Ke}t.mesh.updateVerticesData(Se.oZy.ColorKind,r,!1,!1)}(this),en("colors"),this.mesh.subMeshes[0].indexCount=6*this._alive,0===this._alive&&0===this.rate&&(this.disposeOnEmpty?this.dispose():this.stopOnEmpty&&this.stop()),en("end")};var We=Se.y3G.Identity(),Qe=Se.y3G.Identity(),Je=[-1,1,1,-1],tn=[-1,-1,1,1],en=window&&window.MPS_profile_hook?window.MPS_profile_hook:function(){};const nn=Ve;var rn=n(9265);let on={sensitivity:17,touchMode:/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(navigator.userAgent),autoJump:!1,bindings:{forward:"W",left:"A",backward:"S",right:"D",fire:"<mouse 1>","mid-fire":"<mouse 2>","alt-fire":"<mouse 3>",jump:"<space>",sprint:"<shift>",crouch:"<control>",inventory:"E",esc:"<escape>",hb1:"1",hb2:"2",hb3:"3",hb4:"4",hb5:"5",hb6:"6",hb7:"7",hb8:"8",hb9:"9"},thirdPersonZoom:8};on.autoJump=on.touchMode,window.touchMode=on.touchMode,n(722).Qp(r("bsl"),{allowTouchMove:t=>"control-pad"==t.id||"noa-container"==t.id});var sn=new Ie({debug:!0,showFPS:!0,chunkSize:32,playerStart:[32,64,32],gravity:[0,-16,0],sensitivityX:on.sensitivity,sensitivityY:on.sensitivity,bindings:on.bindings,playerAutoStep:on.autoJump});const an=sn;!function(){let t={up:!1,"up-left":!1,left:!1,jump:!1,right:!1,"up-right":!1,down:!1},e="";function n(n){n&&(e=n),window.touchMode?r("control-pad").style.display="":r("control-pad").style.display="none",t.up||t["up-left"]||t["up-right"]?r("up-left").style.display=r("up-right").style.display="":r("up-left").style.display=r("up-right").style.display="none",an.inputs.state={...an.inputs.state,forward:t.up||t["up-left"]||t["up-right"],left:t.left||t["up-left"],right:t.right||t["up-right"],backward:t.down,jump:t.jump}}function i(){Object.keys(t).map((e=>{r(e).classList.remove("active"),t[e]=!1}))}n(),window.updateTouch=n,window.addEventListener("touchstart",(e=>{Object.keys(t).includes(e.target.id)&&(e.target.classList.add("active"),t[e.target.id]=!0,n(e.target))})),window.addEventListener("touchmove",(r=>{[...r.touches].forEach((r=>{if(!Object.keys(t).includes(r.target.id))return;let o=document.elementFromPoint(r.pageX,r.pageY);o&&(i(),Object.keys(t).includes(o.id)?(o.classList.add("active"),t[o.id]=!0,n(o)):"control-pad"==o.id&&e&&(e.classList.add("active"),t[e.id]=!0,n()))}))})),window.addEventListener("touchend",(e=>{Object.keys(t).includes(e.target.id)&&(i(),n())}))}(),window.setSensitivity=function(t){on.sensitivity=+t,window.touchMode&&(on.sensitivity*=3),sn.camera.sensitivityX=sn.camera.sensitivityY=on.sensitivity},window.setSensitivity(on.sensitivity),window.setTouchMode=function(t){on.touchMode=window.touchMode=t,window.updateTouch(),window.setSensitivity(on.sensitivity),sn.entities.getPhysics(sn.playerEntity).body.autoStep=on.autoJump||on.touchMode};let cn={dirt:new Re("dirt",[]),grass:new Re("grass",["grass_top","dirt","grass_side"],{prev:"grass_side"}),stone:new Re("stone",[]),planks:new Re("planks",[]),sand:new Re("sand",[]),gravel:new Re("gravel",[]),bedrock:new Re("bedrock",[]),cobblestone:new Re("cobblestone",[]),bricks:new Re("bricks",[]),obsidian:new Re("obsidian",[]),mossyCobblestone:new Re("mossy_cobblestone",[]),oakLog:new Re("oak_log",["oak_log_face","oak_log_side"],{prev:"oak_log_side"}),glass:new Re("glass",[],{transparent:!0}),sapling:new Re("sapling",[],{flowerType:!0})},un=cn.grass,ln=[cn.grass,cn.dirt,cn.planks,cn.oakLog,cn.cobblestone,cn.stone,cn.bricks,cn.obsidian,cn.bedrock],hn=1,dn=t=>60*(t-1)-3;window.setHotbarSelection=function(t){hn=t,r("hotbar-selection").style.left=dn(t)+"px",[1,2,3,4,5,6,7,8,9].map((t=>r(`hotbar-item-${t}`).classList.remove("selected"))),r(`hotbar-item-${hn}`).classList.add("selected"),un=ln[hn-1]},window.setHotbarSelection(hn),window.updateHotbar=function(){[1,2,3,4,5,6,7,8,9].forEach((t=>{let e=r(`hotbar-item-${t}`);e.firstChild&&e.firstChild.remove();let n=ln[t-1];if(!n)return;let i=document.createElement("canvas");i.width=48,i.height=48,e.appendChild(i),e.style.left=dn(t)+"px",function(t,e,n,r,i){let o=new Se.D4V(t,!0,{preserveDrawingBuffer:!0,stencil:!0,disableWebGL2Support:!1});const s=new Se.xsS(o);s.clearColor=new Se.HEv(0,0,0,0);const a=new Se.YfP("Camera",-Math.PI/4,Math.PI/3,4,Se.Pa4.Zero());a.attachControl(t,!0),new Se.ezm("light",new Se.Pa4(.8,1,-.3));const c=new Se.KuD("matTop");let u=new Se.xEZ(`img/blocks/${e}.png`);u.hasAlpha=!0,c.diffuseTexture=u;const l=new Se.KuD("matLeft");let h=new Se.xEZ(`img/blocks/${n}.png`);h.hasAlpha=!0,l.diffuseTexture=h;const d=new Se.KuD("matRight");let f=new Se.xEZ(`img/blocks/${r}.png`);f.hasAlpha=!0,d.diffuseTexture=f;let p=Se.VO7.CreatePlane("top",{size:1});p.material=c,p.rotation.x=Math.PI/2,p.position.y=.5;let v=Se.VO7.CreatePlane("left",{size:1});v.material=l,v.rotation.y=-Math.PI/2,v.position.x=.5;let m=Se.VO7.CreatePlane("right",{size:1});m.material=d,m.rotation.y=0,m.position.z=-.5,a.fov=.45,o.runRenderLoop((function(){s&&s.activeCamera&&s.render()}))}(i,...n.getPreviewTex(),n.flowerType)}))},window.updateHotbar(),window.addEventListener("touchstart",(t=>{if(!t.target.id.startsWith("hotbar-item-"))return;let e=Number(t.target.id.substring("hotbar-item-".length))||1;window.setHotbarSelection(e)})),[1,2,3,4,5,6,7,8,9].map((t=>sn.inputs.down.on(`hb${t}`,(()=>window.setHotbarSelection(t))))),sn.blockTargetIdCheck=t=>0!==t,Object.values(cn).forEach((t=>{let e=document.createElement("div");e.className="invblock",e.id=`inv-${t.name}`,e.style=`background-image: url(img/blocks/${t.preview}.png)`,e.onclick=function(){un=t,r("blocks").style.display="none",sn.container.setPointerLock(!0)},r("blocks").appendChild(e)})),sn.inputs.up.on("esc",(()=>{"none"!==r("blocks").style.display&&(r("blocks").style.display="none",sn.container.setPointerLock(!0))}));let fn=new function(t){this.seed,this.levels,this.fuzz,this.seed=Math.random(),this.levels=0,this.fuzz=16,this.levels=t,this.read=function(t,e){let n,r,i=[],o=this.levels,s=t>>o;for(n=0;n<e;n+=s)for(r=0;r<t;r+=s)i[r+n*t]=(ze(0,255)-128)*this.fuzz;for(s=t>>o;s>1;s/=2){let a,c,u,l,h,d,f;for(n=256*(s<<o),r=s/2,a=0;a<e;a+=s)for(c=0;c<t;c+=s)u=i[c%t+a%e*t],l=i[(c+s)%t+a%e*t],h=i[c%t+(a+s)%e*t],d=i[(c+s)%t+(a+s)%e*t],f=(u+h+l+d)/4+ze(0,2*n-1)-n,i[c+r+(a+r)*t]=f;for(a=0;a<e;a+=s)for(c=0;c<t;c+=s){u=i[c+a*t],l=i[(c+s)%t+a*t],h=i[c+(a+s)%t*t],d=i[(c+r&t-1)+(a+r-s&e-1)*t],f=i[(c+r-s&t-1)+(a+r&e-1)*t];let o=i[(c+r)%t+(a+r)%e*t],p=(u+l+o+d)/4+ze(0,2*n-1)-n,v=(u+h+o+f)/4+ze(0,2*n-1)-n;i[c+r+a*t]=p,i[c+(a+r)*t]=v}}let a=[];for(n=0;n<e;++n)for(r=0;r<t;++r)a[r+n*t]=i[r%t+n%e*t]/512+128;return a}}(0).read(64,64);function pn(t,e,n){if(t>=64||e>=64||n>=64)return 0;if(t<0||e<0||n<0)return 0;let r=Math.floor(fn[t+64*n]/3);return 0==e?cn.bedrock.id:e==r?cn.grass.id:e<r&&e>=r-3?cn.dirt.id:e<r-3?cn.stone.id:0}window.n=[],sn.world.on("worldDataNeeded",(function(t,e,n,r,i){for(var o=0;o<e.shape[0];o++)for(var s=0;s<e.shape[1];s++)for(var a=0;a<e.shape[2];a++){var c=pn(n+o,r+s,i+a);e.set(o,s,a,c)}sn.world.setChunkData(t,e)}));var vn=sn.playerEntity,mn=sn.entities.getPositionData(vn),gn=mn.width,yn=mn.height,_n=sn.rendering.getScene(),bn=K.Kj.CreateBox("player-mesh",1,_n);bn.scaling.x=gn,bn.scaling.z=gn,bn.scaling.y=yn,sn.entities.addComponent(vn,sn.entities.names.mesh,{mesh:bn,offset:[0,yn/2,0]});let kn={},wn=0,xn=!1;function Mn(){if(sn.targetedBlock){var t=sn.targetedBlock.position;sn.setBlock(0,t[0],t[1],t[2]);let r=Object.values(cn).find((t=>t.id==sn.targetedBlock.blockID));var e=kn[r.name]||(kn[r.name]=new rn.x(`img/blocks/${r.preview}.png`,_n));e.uAng=e.vAng=Math.PI;var n=new nn(80,80,_n);n.disposeOnEmpty=!0,n.initParticle=function(t){t.position.copyFromFloats(Math.random(),Math.max(Math.random(),.6),Math.random()),t.velocity.x=(Math.random()>.5?1:-1)*Math.random()/1.5,t.velocity.y=3*-Math.random(),t.velocity.z=(Math.random()>.5?1:-1)*Math.random()/1.5,t.size=.3,t.age=0,t.lifetime=2*Math.random()},n.setTexture(e),n.setSizeRange(.4,.4),n.mesh.position.x=t[0],n.mesh.position.y=t[1],n.mesh.position.z=t[2],sn.rendering.addMeshToScene(n.mesh),n.start(),setTimeout((function(){n.rate=0}),350),wn=0}}sn.inputs.down.on("alt-fire",(function(){xn=!0,Mn()})),sn.inputs.up.on("alt-fire",(function(){xn=!1}));let Cn=!1,Pn=[];function Tn(){if(sn.targetedBlock){var t=sn.targetedBlock.adjacent;sn.setBlock(un.id,t[0],t[1],t[2]),Pn=[...t]}}sn.inputs.down.on("fire",(function(){Cn=!0,Tn()})),sn.inputs.up.on("fire",(function(){Cn=!1})),sn.inputs.up.on("mid-fire",(function(){sn.targetedBlock&&(un=Object.values(cn).find((t=>t.id==sn.targetedBlock.blockID))||cn.grass)})),sn.inputs.up.on("inventory",(function(){let t="none"==r("blocks").style.display;r("blocks").style.display=t?"":"none",console.log(t),t?sn.container.setPointerLock(!1):sn.container.setPointerLock(!0)})),sn.on("tick",(function(t){wn++;let e=sn.inputs.state.scrolly;if(0!==e){let t=hn+(e>0?1:-1);console.log(hn,t,e),t<1&&(t=9),t>9&&(t=1),setHotbarSelection(t)}let n=sn.entities.getPositionData(sn.playerEntity).position.map((t=>Math.ceil(t)));r("coordinate-display").innerHTML=`${n[0]}, ${n[1]}, ${n[2]}`,n[1]<0&&sn.entities.setPosition(sn.playerEntity,[32,64,32]),xn&&wn%12==0&&Mn();let i=(sn.targetedBlock||{}).position;i&&(!Cn||Pn[0]===i[0]&&Pn[1]===i[1]&&Pn[2]===i[2]||Tn())}))},4409:t=>{t.exports=function(t){return null!=t&&null!=t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}},9171:(t,e,n)=>{"use strict";var r=n(9425),i=n(763),o=n(4409);n.g.__TYPEDARRAY_POOL||(n.g.__TYPEDARRAY_POOL={UINT8:i([32,0]),UINT16:i([32,0]),UINT32:i([32,0]),INT8:i([32,0]),INT16:i([32,0]),INT32:i([32,0]),FLOAT:i([32,0]),DOUBLE:i([32,0]),DATA:i([32,0]),UINT8C:i([32,0]),BUFFER:i([32,0])});var s="undefined"!=typeof Uint8ClampedArray,a=n.g.__TYPEDARRAY_POOL;a.UINT8C||(a.UINT8C=i([32,0])),a.BUFFER||(a.BUFFER=i([32,0]));var c=a.DATA,u=a.BUFFER;function l(t){if(t){var e=t.length||t.byteLength,n=r.log2(e);c[n].push(t)}}function h(t){t=r.nextPow2(t);var e=r.log2(t),n=c[e];return n.length>0?n.pop():new ArrayBuffer(t)}function d(t){return new Uint8Array(h(t),0,t)}function f(t){return new Uint16Array(h(2*t),0,t)}function p(t){return new Uint32Array(h(4*t),0,t)}function v(t){return new Int8Array(h(t),0,t)}function m(t){return new Int16Array(h(2*t),0,t)}function g(t){return new Int32Array(h(4*t),0,t)}function y(t){return new Float32Array(h(4*t),0,t)}function _(t){return new Float64Array(h(8*t),0,t)}function b(t){return s?new Uint8ClampedArray(h(t),0,t):d(t)}function k(t){return new DataView(h(t),0,t)}e.free=function(t){if(o(t))u[r.log2(t.length)].push(t);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(t)&&(t=t.buffer),!t)return;var e=t.length||t.byteLength,n=0|r.log2(e);c[n].push(t)}},e.freeUint8=e.freeUint16=e.freeUint32=e.freeInt8=e.freeInt16=e.freeInt32=e.freeFloat32=e.freeFloat=e.freeFloat64=e.freeDouble=e.freeUint8Clamped=e.freeDataView=function(t){l(t.buffer)},e.freeArrayBuffer=l,e.freeBuffer=function(t){u[r.log2(t.length)].push(t)},e.malloc=function(t,e){if(void 0===e||"arraybuffer"===e)return h(t);switch(e){case"uint8":return d(t);case"uint16":return f(t);case"uint32":return p(t);case"int8":return v(t);case"int16":return m(t);case"int32":return g(t);case"float":case"float32":return y(t);case"double":case"float64":return _(t);case"uint8_clamped":return b(t);case"buffer":throw"Buffer not supported";case"data":case"dataview":return k(t);default:return null}return null},e.mallocArrayBuffer=h,e.mallocUint8=d,e.mallocUint16=f,e.mallocUint32=p,e.mallocInt8=v,e.mallocInt16=m,e.mallocInt32=g,e.mallocFloat32=e.mallocFloat=y,e.mallocFloat64=e.mallocDouble=_,e.mallocUint8Clamped=b,e.mallocDataView=k,e.clearCache=function(){for(var t=0;t<32;++t)a.UINT8[t].length=0,a.UINT16[t].length=0,a.UINT32[t].length=0,a.INT8[t].length=0,a.INT16[t].length=0,a.INT32[t].length=0,a.FLOAT[t].length=0,a.DOUBLE[t].length=0,a.UINT8C[t].length=0,c[t].length=0,u[t].length=0}},6133:(t,e,n)=>{t.exports=i;var r=n(7729);function i(t,e){if(!(this instanceof i))return new i(t,e);var n=r.create();r.add(n,t,e),this.base=r.min(r.create(),t,n),this.vec=r.clone(e),this.max=r.max(r.create(),t,n),this.mag=r.length(this.vec)}var o=i.prototype;o.width=function(){return this.vec[0]},o.height=function(){return this.vec[1]},o.depth=function(){return this.vec[2]},o.x0=function(){return this.base[0]},o.y0=function(){return this.base[1]},o.z0=function(){return this.base[2]},o.x1=function(){return this.max[0]},o.y1=function(){return this.max[1]},o.z1=function(){return this.max[2]},o.translate=function(t){return r.add(this.max,this.max,t),r.add(this.base,this.base,t),this},o.setPosition=function(t){return r.add(this.max,t,this.vec),r.copy(this.base,t),this},o.expand=function(t){var e=r.create(),n=r.create();return r.max(e,t.max,this.max),r.min(n,t.base,this.base),r.subtract(e,e,n),new i(n,e)},o.intersects=function(t){return!(t.base[0]>this.max[0]||t.base[1]>this.max[1]||t.base[2]>this.max[2]||t.max[0]<this.base[0]||t.max[1]<this.base[1]||t.max[2]<this.base[2])},o.touches=function(t){var e=this.union(t);return null!==e&&(0==e.width()||0==e.height()||0==e.depth())},o.union=function(t){if(!this.intersects(t))return null;var e=Math.max(t.base[0],this.base[0]),n=Math.max(t.base[1],this.base[1]),r=Math.max(t.base[2],this.base[2]);return new i([e,n,r],[Math.min(t.max[0],this.max[0])-e,Math.min(t.max[1],this.max[1])-n,Math.min(t.max[2],this.max[2])-r])}},9425:(t,e)=>{"use strict";function n(t){var e=32;return(t&=-t)&&e--,65535&t&&(e-=16),16711935&t&&(e-=8),252645135&t&&(e-=4),858993459&t&&(e-=2),1431655765&t&&(e-=1),e}e.INT_BITS=32,e.INT_MAX=2147483647,e.INT_MIN=-1<<31,e.sign=function(t){return(t>0)-(t<0)},e.abs=function(t){var e=t>>31;return(t^e)-e},e.min=function(t,e){return e^(t^e)&-(t<e)},e.max=function(t,e){return t^(t^e)&-(t<e)},e.isPow2=function(t){return!(t&t-1||!t)},e.log2=function(t){var e,n;return e=(t>65535)<<4,e|=n=((t>>>=e)>255)<<3,e|=n=((t>>>=n)>15)<<2,(e|=n=((t>>>=n)>3)<<1)|(t>>>=n)>>1},e.log10=function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},e.popCount=function(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24},e.countTrailingZeros=n,e.nextPow2=function(t){return t+=0===t,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,1+(t|=t>>>16)},e.prevPow2=function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)},e.parity=function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1};var r=new Array(256);!function(t){for(var e=0;e<256;++e){var n=e,r=e,i=7;for(n>>>=1;n;n>>>=1)r<<=1,r|=1&n,--i;t[e]=r<<i&255}}(r),e.reverse=function(t){return r[255&t]<<24|r[t>>>8&255]<<16|r[t>>>16&255]<<8|r[t>>>24&255]},e.interleave2=function(t,e){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))<<1},e.deinterleave2=function(t,e){return(t=65535&((t=16711935&((t=252645135&((t=858993459&((t=t>>>e&1431655765)|t>>>1))|t>>>2))|t>>>4))|t>>>16))<<16>>16},e.interleave3=function(t,e,n){return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2),(t|=(e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2))<<1)|(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<2},e.deinterleave3=function(t,e){return(t=1023&((t=4278190335&((t=251719695&((t=3272356035&((t=t>>>e&1227133513)|t>>>2))|t>>>4))|t>>>8))|t>>>16))<<22>>22},e.nextCombination=function(t){var e=t|t-1;return e+1|(~e&-~e)-1>>>n(t)+1}},9578:(t,e,n)=>{"use strict";t.exports=function(t,e,n){switch(arguments.length){case 1:return h(t);case 2:return"function"==typeof e?u(t,t,e,!0):d(t,e);case 3:return u(t,e,n,!1);default:throw new Error("box-intersect: Invalid arguments")}};var r,i=n(9171),o=n(6407),s=n(1131);function a(t,e){for(var n=0;n<t;++n)if(!(e[n]<=e[n+t]))return!0;return!1}function c(t,e,n,r){for(var i=0,o=0,s=0,c=t.length;s<c;++s){var u=t[s];if(!a(e,u)){for(var l=0;l<2*e;++l)n[i++]=u[l];r[o++]=s}}return o}function u(t,e,n,r){var a=t.length,u=e.length;if(!(a<=0||u<=0)){var l=t[0].length>>>1;if(!(l<=0)){var h,d=i.mallocDouble(2*l*a),f=i.mallocInt32(a);if((a=c(t,l,d,f))>0){if(1===l&&r)o.init(a),h=o.sweepComplete(l,n,0,a,d,f,0,a,d,f);else{var p=i.mallocDouble(2*l*u),v=i.mallocInt32(u);(u=c(e,l,p,v))>0&&(o.init(a+u),h=1===l?o.sweepBipartite(l,n,0,a,d,f,0,u,p,v):s(l,n,r,a,d,f,u,p,v),i.free(p),i.free(v))}i.free(d),i.free(f)}return h}}}function l(t,e){r.push([t,e])}function h(t){return r=[],u(t,t,l,!0),r}function d(t,e){return r=[],u(t,e,l,!1),r}},3131:(t,e)=>{"use strict";var n=["d","ax","vv","rs","re","rb","ri","bs","be","bb","bi"];function r(t){var e="bruteForce"+(t?"Full":"Partial"),r=[],i=n.slice();t||i.splice(3,0,"fp");var o=["function "+e+"("+i.join()+"){"];function s(e,i){var s=function(t,e,r){var i="bruteForce"+(t?"Red":"Blue")+(e?"Flip":"")+(r?"Full":""),o=["function ",i,"(",n.join(),"){","var ","es","=2*","d",";"],s="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",a="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(r?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return t?o.push(s,"Q",":",a):o.push(a,"Q",":",s),r?o.push("if(y1<x0||x1<y0)continue;"):e?o.push("if(y0<=x0||x1<y0)continue;"):o.push("if(y0<x0||x1<y0)continue;"),o.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),e?o.push("yi,xi"):o.push("xi,yi"),o.push(");if(rv!==void 0)return rv;}}}"),{name:i,code:o.join("")}}(e,i,t);r.push(s.code),o.push("return "+s.name+"("+n.join()+");")}o.push("if(re-rs>be-bs){"),t?(s(!0,!1),o.push("}else{"),s(!1,!1)):(o.push("if(fp){"),s(!0,!0),o.push("}else{"),s(!0,!1),o.push("}}else{if(fp){"),s(!1,!0),o.push("}else{"),s(!1,!1),o.push("}")),o.push("}}return "+e);var a=r.join("")+o.join("");return new Function(a)()}e.partial=r(!1),e.full=r(!0)},1131:(t,e,n)=>{"use strict";t.exports=function(t,e,n,o,l,w,x,M,C){!function(t,e){var n=8*i.log2(e+1)*(t+1)|0,o=i.nextPow2(6*n);g.length<o&&(r.free(g),g=r.mallocInt32(o));var s=i.nextPow2(2*n);y.length<s&&(r.free(y),y=r.mallocDouble(s))}(t,o+x);var P,T=0,D=2*t;for(_(T++,0,0,o,0,x,n?16:0,-1/0,1/0),n||_(T++,0,0,x,0,o,1,-1/0,1/0);T>0;){var A=6*(T-=1),j=g[A],E=g[A+1],I=g[A+2],L=g[A+3],O=g[A+4],S=g[A+5],B=2*T,F=y[B],R=y[B+1],z=1&S,U=!!(16&S),N=l,q=w,H=M,V=C;if(z&&(N=M,q=C,H=l,V=w),!(2&S&&(I=f(t,j,E,I,N,q,R),E>=I)||4&S&&(E=p(t,j,E,I,N,q,F))>=I)){var Z=I-E,K=O-L;if(U){if(t*Z*(Z+K)<4194304){if(void 0!==(P=c.scanComplete(t,j,e,E,I,N,q,L,O,H,V)))return P;continue}}else{if(t*Math.min(Z,K)<128){if(void 0!==(P=s(t,j,e,z,E,I,N,q,L,O,H,V)))return P;continue}if(t*Z*K<4194304){if(void 0!==(P=c.scanBipartite(t,j,e,z,E,I,N,q,L,O,H,V)))return P;continue}}var G=h(t,j,E,I,N,q,F,R);if(E<G)if(t*(G-E)<128){if(void 0!==(P=a(t,j+1,e,E,G,N,q,L,O,H,V)))return P}else if(j===t-2){if(void 0!==(P=z?c.sweepBipartite(t,e,L,O,H,V,E,G,N,q):c.sweepBipartite(t,e,E,G,N,q,L,O,H,V)))return P}else _(T++,j+1,E,G,L,O,z,-1/0,1/0),_(T++,j+1,L,O,E,G,1^z,-1/0,1/0);if(G<I){var Y=u(t,j,L,O,H,V),X=H[D*Y+j],$=d(t,j,Y,O,H,V,X);if($<O&&_(T++,j,G,I,$,O,(4|z)+(U?16:0),X,R),L<Y&&_(T++,j,G,I,L,Y,(2|z)+(U?16:0),F,X),Y+1===$){if(void 0!==(P=U?k(t,j,e,G,I,N,q,Y,H,V[Y]):b(t,j,e,z,G,I,N,q,Y,H,V[Y])))return P}else if(Y<$){var W;if(U){if(G<(W=v(t,j,G,I,N,q,X))){var Q=d(t,j,G,W,N,q,X);if(j===t-2){if(G<Q&&void 0!==(P=c.sweepComplete(t,e,G,Q,N,q,Y,$,H,V)))return P;if(Q<W&&void 0!==(P=c.sweepBipartite(t,e,Q,W,N,q,Y,$,H,V)))return P}else G<Q&&_(T++,j+1,G,Q,Y,$,16,-1/0,1/0),Q<W&&(_(T++,j+1,Q,W,Y,$,0,-1/0,1/0),_(T++,j+1,Y,$,Q,W,1,-1/0,1/0))}}else G<(W=z?m(t,j,G,I,N,q,X):v(t,j,G,I,N,q,X))&&(j===t-2?P=z?c.sweepBipartite(t,e,Y,$,H,V,G,W,N,q):c.sweepBipartite(t,e,G,W,N,q,Y,$,H,V):(_(T++,j+1,G,W,Y,$,z,-1/0,1/0),_(T++,j+1,Y,$,G,W,1^z,-1/0,1/0)))}}}}};var r=n(9171),i=n(9425),o=n(3131),s=o.partial,a=o.full,c=n(6407),u=n(9298),l=n(6750),h=l("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),d=l("lo===p0",["p0"]),f=l("lo<p0",["p0"]),p=l("hi<=p0",["p0"]),v=l("lo<=p0&&p0<=hi",["p0"]),m=l("lo<p0&&p0<=hi",["p0"]),g=r.mallocInt32(1024),y=r.mallocDouble(1024);function _(t,e,n,r,i,o,s,a,c){var u=6*t;g[u]=e,g[u+1]=n,g[u+2]=r,g[u+3]=i,g[u+4]=o,g[u+5]=s;var l=2*t;y[l]=a,y[l+1]=c}function b(t,e,n,r,i,o,s,a,c,u,l){var h=2*t,d=c*h,f=u[d+e];t:for(var p=i,v=i*h;p<o;++p,v+=h){var m=s[v+e],g=s[v+e+t];if(!(f<m||g<f||r&&f===m)){for(var y,_=a[p],b=e+1;b<t;++b){m=s[v+b],g=s[v+b+t];var k=u[d+b],w=u[d+b+t];if(g<k||w<m)continue t}if(void 0!==(y=r?n(l,_):n(_,l)))return y}}}function k(t,e,n,r,i,o,s,a,c,u){var l=2*t,h=a*l,d=c[h+e];t:for(var f=r,p=r*l;f<i;++f,p+=l){var v=s[f];if(v!==u){var m=o[p+e],g=o[p+e+t];if(!(d<m||g<d)){for(var y=e+1;y<t;++y){m=o[p+y],g=o[p+y+t];var _=c[h+y],b=c[h+y+t];if(g<_||b<m)continue t}var k=n(v,u);if(void 0!==k)return k}}}}},9298:(t,e,n)=>{"use strict";t.exports=function(t,e,n,o,s,a){if(o<=n+1)return n;for(var c=n,u=o,l=o+n>>>1,h=2*t,d=l,f=s[h*l+e];c<u;){if(u-c<8){i(t,e,c,u,s,a),f=s[h*l+e];break}var p=u-c,v=Math.random()*p+c|0,m=s[h*v+e],g=Math.random()*p+c|0,y=s[h*g+e],_=Math.random()*p+c|0,b=s[h*_+e];m<=y?b>=y?(d=g,f=y):m>=b?(d=v,f=m):(d=_,f=b):y>=b?(d=g,f=y):b>=m?(d=v,f=m):(d=_,f=b);for(var k=h*(u-1),w=h*d,x=0;x<h;++x,++k,++w){var M=s[k];s[k]=s[w],s[w]=M}var C=a[u-1];for(a[u-1]=a[d],a[d]=C,k=h*(u-1),w=h*(d=r(t,e,c,u-1,s,a,f)),x=0;x<h;++x,++k,++w)M=s[k],s[k]=s[w],s[w]=M;if(C=a[u-1],a[u-1]=a[d],a[d]=C,l<d){for(u=d-1;c<u&&s[h*(u-1)+e]===f;)u-=1;u+=1}else{if(!(d<l))break;for(c=d+1;c<u&&s[h*c+e]===f;)c+=1}}return r(t,e,n,l,s,a,s[h*l+e])};var r=n(6750)("lo<p0",["p0"]);function i(t,e,n,r,i,o){for(var s=2*t,a=s*(n+1)+e,c=n+1;c<r;++c,a+=s)for(var u=i[a],l=c,h=s*(c-1);l>n&&i[h+e]>u;--l,h-=s){for(var d=h,f=h+s,p=0;p<s;++p,++d,++f){var v=i[d];i[d]=i[f],i[f]=v}var m=o[l];o[l]=o[l-1],o[l-1]=m}}},6750:t=>{"use strict";t.exports=function(t,e){var n="abcdef".split("").concat(e),r=[];return t.indexOf("lo")>=0&&r.push("lo=e[k+n]"),t.indexOf("hi")>=0&&r.push("hi=e[k+o]"),n.push("for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m".replace("_",r.join()).replace("$",t)),Function.apply(void 0,n)}},1208:t=>{"use strict";function e(t,e,n){for(var r=2*(t+1),i=t+1;i<=e;++i){for(var o=n[r++],s=n[r++],a=i,c=r-2;a-- >t;){var u=n[c-2],l=n[c-1];if(u<o)break;if(u===o&&l<s)break;n[c]=u,n[c+1]=l,c-=2}n[c]=o,n[c+1]=s}}function n(t,e,n){e*=2;var r=n[t*=2],i=n[t+1];n[t]=n[e],n[t+1]=n[e+1],n[e]=r,n[e+1]=i}function r(t,e,n){e*=2,n[t*=2]=n[e],n[t+1]=n[e+1]}function i(t,e,n,r){e*=2,n*=2;var i=r[t*=2],o=r[t+1];r[t]=r[e],r[t+1]=r[e+1],r[e]=r[n],r[e+1]=r[n+1],r[n]=i,r[n+1]=o}function o(t,e,n,r,i){e*=2,i[t*=2]=i[e],i[e]=n,i[t+1]=i[e+1],i[e+1]=r}function s(t,e,n){e*=2;var r=n[t*=2],i=n[e];return!(r<i)&&(r!==i||n[t+1]>n[e+1])}function a(t,e,n,r){var i=r[t*=2];return i<e||i===e&&r[t+1]<n}function c(t,u,l){var h=(u-t+1)/6|0,d=t+h,f=u-h,p=t+u>>1,v=p-h,m=p+h,g=d,y=v,_=p,b=m,k=f,w=t+1,x=u-1,M=0;s(g,y,l)&&(M=g,g=y,y=M),s(b,k,l)&&(M=b,b=k,k=M),s(g,_,l)&&(M=g,g=_,_=M),s(y,_,l)&&(M=y,y=_,_=M),s(g,b,l)&&(M=g,g=b,b=M),s(_,b,l)&&(M=_,_=b,b=M),s(y,k,l)&&(M=y,y=k,k=M),s(y,_,l)&&(M=y,y=_,_=M),s(b,k,l)&&(M=b,b=k,k=M);for(var C=l[2*y],P=l[2*y+1],T=l[2*b],D=l[2*b+1],A=2*g,j=2*_,E=2*k,I=2*d,L=2*p,O=2*f,S=0;S<2;++S){var B=l[A+S],F=l[j+S],R=l[E+S];l[I+S]=B,l[L+S]=F,l[O+S]=R}r(v,t,l),r(m,u,l);for(var z=w;z<=x;++z)if(a(z,C,P,l))z!==w&&n(z,w,l),++w;else if(!a(z,T,D,l))for(;;){if(a(x,T,D,l)){a(x,C,P,l)?(i(z,w,x,l),++w,--x):(n(z,x,l),--x);break}if(--x<z)break}o(t,w-1,C,P,l),o(u,x+1,T,D,l),w-2-t<=32?e(t,w-2,l):c(t,w-2,l),u-(x+2)<=32?e(x+2,u,l):c(x+2,u,l),x-w<=32?e(w,x,l):c(w,x,l)}t.exports=function(t,n){n<=128?e(0,n-1,t):c(0,n-1,t)}},6407:(t,e,n)=>{"use strict";t.exports={init:function(t){var e=i.nextPow2(t);c.length<e&&(r.free(c),c=r.mallocInt32(e)),u.length<e&&(r.free(u),u=r.mallocInt32(e)),l.length<e&&(r.free(l),l=r.mallocInt32(e)),h.length<e&&(r.free(h),h=r.mallocInt32(e)),d.length<e&&(r.free(d),d=r.mallocInt32(e)),f.length<e&&(r.free(f),f=r.mallocInt32(e));var n=8*e;p.length<n&&(r.free(p),p=r.mallocDouble(n))},sweepBipartite:function(t,e,n,r,i,a,d,f,g,y){for(var _=0,b=2*t,k=t-1,w=b-1,x=n;x<r;++x){var M=a[x],C=b*x;p[_++]=i[C+k],p[_++]=-(M+1),p[_++]=i[C+w],p[_++]=M}for(x=d;x<f;++x){M=y[x]+s;var P=b*x;p[_++]=g[P+k],p[_++]=-M,p[_++]=g[P+w],p[_++]=M}var T=_>>>1;o(p,T);var D=0,A=0;for(x=0;x<T;++x){var j=0|p[2*x+1];if(j>=s)v(l,h,A--,j=j-s|0);else if(j>=0)v(c,u,D--,j);else if(j<=-268435456){j=-j-s|0;for(var E=0;E<D;++E)if(void 0!==(I=e(c[E],j)))return I;m(l,h,A++,j)}else{for(j=-j-1|0,E=0;E<A;++E){var I;if(void 0!==(I=e(j,l[E])))return I}m(c,u,D++,j)}}},sweepComplete:function(t,e,n,r,i,s,a,g,y,_){for(var b=0,k=2*t,w=t-1,x=k-1,M=n;M<r;++M){var C=s[M]+1<<1,P=k*M;p[b++]=i[P+w],p[b++]=-C,p[b++]=i[P+x],p[b++]=C}for(M=a;M<g;++M){C=_[M]+1<<1;var T=k*M;p[b++]=y[T+w],p[b++]=1|-C,p[b++]=y[T+x],p[b++]=1|C}var D=b>>>1;o(p,D);var A=0,j=0,E=0;for(M=0;M<D;++M){var I=0|p[2*M+1],L=1&I;if(M<D-1&&I>>1==p[2*M+3]>>1&&(L=2,M+=1),I<0){for(var O=-(I>>1)-1,S=0;S<E;++S)if(void 0!==(B=e(d[S],O)))return B;if(0!==L)for(S=0;S<A;++S)if(void 0!==(B=e(c[S],O)))return B;if(1!==L)for(S=0;S<j;++S){var B;if(void 0!==(B=e(l[S],O)))return B}0===L?m(c,u,A++,O):1===L?m(l,h,j++,O):2===L&&m(d,f,E++,O)}else O=(I>>1)-1,0===L?v(c,u,A--,O):1===L?v(l,h,j--,O):2===L&&v(d,f,E--,O)}},scanBipartite:function(t,e,n,r,i,a,l,h,d,f,g,y){var _=0,b=2*t,k=e,w=e+t,x=1,M=1;r?M=s:x=s;for(var C=i;C<a;++C){var P=C+x,T=b*C;p[_++]=l[T+k],p[_++]=-P,p[_++]=l[T+w],p[_++]=P}for(C=d;C<f;++C){P=C+M;var D=b*C;p[_++]=g[D+k],p[_++]=-P}var A=_>>>1;o(p,A);var j=0;for(C=0;C<A;++C){var E=0|p[2*C+1];if(E<0){var I=!1;if((P=-E)>=s?(I=!r,P-=s):(I=!!r,P-=1),I)m(c,u,j++,P);else{var L=y[P],O=b*P,S=g[O+e+1],B=g[O+e+1+t];t:for(var F=0;F<j;++F){var R=c[F],z=b*R;if(!(B<l[z+e+1]||l[z+e+1+t]<S)){for(var U=e+2;U<t;++U)if(g[O+U+t]<l[z+U]||l[z+U+t]<g[O+U])continue t;var N,q=h[R];if(void 0!==(N=r?n(L,q):n(q,L)))return N}}}}else v(c,u,j--,E-x)}},scanComplete:function(t,e,n,r,i,a,u,l,h,d,f){for(var v=0,m=2*t,g=e,y=e+t,_=r;_<i;++_){var b=_+s,k=m*_;p[v++]=a[k+g],p[v++]=-b,p[v++]=a[k+y],p[v++]=b}for(_=l;_<h;++_){b=_+1;var w=m*_;p[v++]=d[w+g],p[v++]=-b}var x=v>>>1;o(p,x);var M=0;for(_=0;_<x;++_){var C=0|p[2*_+1];if(C<0)if((b=-C)>=s)c[M++]=b-s;else{var P=f[b-=1],T=m*b,D=d[T+e+1],A=d[T+e+1+t];t:for(var j=0;j<M;++j){var E=c[j],I=u[E];if(I===P)break;var L=m*E;if(!(A<a[L+e+1]||a[L+e+1+t]<D)){for(var O=e+2;O<t;++O)if(d[T+O+t]<a[L+O]||a[L+O+t]<d[T+O])continue t;var S=n(I,P);if(void 0!==S)return S}}}else{for(b=C-s,j=M-1;j>=0;--j)if(c[j]===b){for(O=j+1;O<M;++O)c[O-1]=c[O];break}--M}}}};var r=n(9171),i=n(9425),o=n(1208),s=1<<28,a=1024,c=r.mallocInt32(a),u=r.mallocInt32(a),l=r.mallocInt32(a),h=r.mallocInt32(a),d=r.mallocInt32(a),f=r.mallocInt32(a),p=r.mallocDouble(8192);function v(t,e,n,r){var i=e[r],o=t[n-1];t[i]=o,e[o]=i}function m(t,e,n,r){t[n]=r,e[r]=n}},763:t=>{"use strict";function e(t,n,r){var i=0|t[r];if(i<=0)return[];var o,s=new Array(i);if(r===t.length-1)for(o=0;o<i;++o)s[o]=n;else for(o=0;o<i;++o)s[o]=e(t,n,r+1);return s}t.exports=function(t,n){switch(void 0===n&&(n=0),typeof t){case"number":if(t>0)return function(t,e){var n,r;for(n=new Array(t),r=0;r<t;++r)n[r]=e;return n}(0|t,n);break;case"object":if("number"==typeof t.length)return e(t,n,0)}return[]}},4542:(t,e,n)=>{t.exports=function(){var t=this;this.components={},this.comps=this.components;var e=this.components,n=1,i={},o=[],s=[],a={timeout:!1,removals:[],multiComps:[]};function c(t,n){var r=e[n],o=i[n],s=o.hash[t];s&&(o.remove(t),r.onRemove&&(r.multi?(s.forEach((e=>{e&&r.onRemove(t,e)})),s.length=0):r.onRemove(t,s)),a.removals.push(o),u())}function u(){a.timeout||(a.timeout=!0,setTimeout(l,1))}function l(){a.timeout=!1,h()}function h(){a.multiComps.length&&function(t){for(var e=0;e<t.length;e++){var{entID:n,data:r}=t[e],i=r.hash[n];if(i){for(var o=0;o<i.length;o++)i[o]||(i.splice(o,1),o--);0===i.length&&(r.remove(n),a.removals.push(r))}}t.length=0}(a.multiComps),a.removals.length&&function(t){for(var e=0;e<t.length;e++)t[e].flush();t.length=0}(a.removals)}this._storage=i,this._systems=o,this._renderSystems=s,this.createEntity=function(e){var r=n++;return Array.isArray(e)&&e.forEach((e=>t.addComponent(r,e))),r},this.deleteEntity=function(e){return Object.keys(i).forEach((t=>{i[t].hash[e]&&c(e,t)})),t},this.createComponent=function(t){if(!t)throw"Missing component definition";var n=t.name;if(!n)throw"Component definition must have a name property.";if("string"!=typeof n)throw"Component name must be a string.";if(""===n)throw"Component name must be a non-empty string.";if(i[n])throw`Component ${n} already exists.`;var a={};return a.name=n,a.multi=!!t.multi,a.order=isNaN(t.order)?99:t.order,a.state=t.state||{},a.onAdd=t.onAdd||null,a.onRemove=t.onRemove||null,a.system=t.system||null,a.renderSystem=t.renderSystem||null,e[n]=a,i[n]=new r,i[n]._pendingMultiCleanup=!1,i[n]._multiCleanupIDs=a.multi?[]:null,a.system&&(o.push(n),o.sort(((t,n)=>e[t].order-e[n].order))),a.renderSystem&&(s.push(n),s.sort(((t,n)=>e[t].order-e[n].order))),n},this.deleteComponent=function(n){var r=i[n];if(!r)throw`Unknown component: ${n}`;r.flush(),r.list.forEach((t=>{t&&c(t.__id||t[0].__id,n)}));var a=o.indexOf(n),u=s.indexOf(n);return a>-1&&o.splice(a,1),u>-1&&s.splice(u,1),i[n].dispose(),delete i[n],delete e[n],t},this.addComponent=function(t,n,r){var o=e[n],s=i[n];if(!s)throw`Unknown component: ${n}.`;if(s.hash[t]&&!o.multi)throw`Entity ${t} already has component: ${n}.`;var a=Object.assign({},{__id:t},o.state,r);if(a.__id=t,o.multi){var c=s.hash[t];c||(c=[],s.add(t,c)),c.push(a)}else s.add(t,a);return o.onAdd&&o.onAdd(t,a),this},this.hasComponent=function(t,e){var n=i[e];if(!n)throw`Unknown component: ${e}.`;return!!n.hash[t]},this.removeComponent=function(e,n){if(!i[n])throw`Unknown component: ${n}.`;return c(e,n),t},this.getState=function(t,e){var n=i[e];if(!n)throw`Unknown component: ${e}.`;return n.hash[t]},this.getStatesList=function(t){var e=i[t];if(!e)throw`Unknown component: ${t}.`;return h(),e.list},this.getStateAccessor=function(t){if(!i[t])throw`Unknown component: ${t}.`;var e=i[t].hash;return t=>e[t]},this.getComponentAccessor=function(t){if(!i[t])throw`Unknown component: ${t}.`;var e=i[t].hash;return t=>!!e[t]},this.tick=function(n){h();for(var r=0;r<o.length;r++){var s=o[r],a=e[s],c=i[s];a.system(n,c.list),h()}return t},this.render=function(n){h();for(var r=0;r<s.length;r++){var o=s[r],a=e[o],c=i[o];a.renderSystem(n,c.list),h()}return t},this.removeMultiComponent=function(n,r,o){var s=e[r],c=i[r];if(!c)throw`Unknown component: ${r}.`;if(!s.multi)throw"removeMultiComponent called on non-multi component";return function(t,e,n,r){var i=n.hash[t];if(i){var o=i[r];o&&(i[r]=null,e.onRemove&&e.onRemove(t,o),a.multiComps.push({entID:t,data:n}),u())}}(n,s,c,o),t}};var r=n(2649)},2649:t=>{function e(t,e){var n=t._map[e];if(delete t.hash[e],delete t._map[e],n===t.list.length-1)t.list.pop();else{var r=t.list.pop();if(t.list[n]=r,null===r||null===r[0]){var i=t.list.length;for(var o in t._map)if(t._map[o]===i)return void(t._map[o]=n)}else{var s=r.__id||r[0].__id;t._map[s]=n}}}t.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(t,e){if("number"==typeof this._map[t]){var n=this._map[t];this.hash[t]=e,this.list[n]=e}else this._map[t]=this.list.length,this.hash[t]=e,this.list.push(e)}remove(t){var e=this._map[t];this.hash[t]=null,this.list[e]=null,this._pendingRemovals.push(t)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var t=0;t<this._pendingRemovals.length;t++){var n=this._pendingRemovals[t];null===this.hash[n]&&e(this,n)}this._pendingRemovals.length=0}}},5602:t=>{"use strict";var e,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};e=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var i=Number.isNaN||function(t){return t!=t};function o(){o.init.call(this)}t.exports=o,t.exports.once=function(t,e){return new Promise((function(n,r){function i(n){t.removeListener(e,o),r(n)}function o(){"function"==typeof t.removeListener&&t.removeListener("error",i),n([].slice.call(arguments))}v(t,e,o,{once:!0}),"error"!==e&&function(t,e,n){"function"==typeof t.on&&v(t,"error",e,{once:!0})}(t,i)}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function a(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function c(t){return void 0===t._maxListeners?o.defaultMaxListeners:t._maxListeners}function u(t,e,n,r){var i,o,s,u;if(a(n),void 0===(o=t._events)?(o=t._events=Object.create(null),t._eventsCount=0):(void 0!==o.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),s=o[e]),void 0===s)s=o[e]=n,++t._eventsCount;else if("function"==typeof s?s=o[e]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(i=c(t))>0&&s.length>i&&!s.warned){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=s.length,u=l,console&&console.warn&&console.warn(u)}return t}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=l.bind(r);return i.listener=n,r.wrapFn=i,i}function d(t,e,n){var r=t._events;if(void 0===r)return[];var i=r[e];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(i):p(i,i.length)}function f(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function v(t,e,n,r){if("function"==typeof t.on)r.once?t.once(e,n):t.on(e,n);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function i(o){r.once&&t.removeEventListener(e,i),n(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(t){if("number"!=typeof t||t<0||i(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");s=t}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||i(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var i="error"===t,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=o[t];if(void 0===c)return!1;if("function"==typeof c)r(c,this,e);else{var u=c.length,l=p(c,u);for(n=0;n<u;++n)r(l[n],this,e)}return!0},o.prototype.addListener=function(t,e){return u(this,t,e,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(t,e){return u(this,t,e,!0)},o.prototype.once=function(t,e){return a(e),this.on(t,h(this,t,e)),this},o.prototype.prependOnceListener=function(t,e){return a(e),this.prependListener(t,h(this,t,e)),this},o.prototype.removeListener=function(t,e){var n,r,i,o,s;if(a(e),void 0===(r=this._events))return this;if(void 0===(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===e||n[o].listener===e){s=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,i),1===n.length&&(r[t]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",t,s||e)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(t){var e,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},o.prototype.listeners=function(t){return d(this,t,!0)},o.prototype.rawListeners=function(t){return d(this,t,!1)},o.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):f.call(t,e)},o.prototype.listenerCount=f,o.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]}},4386:t=>{"use strict";t.exports=function(t,e,n,r,i,o){var s=+e[0],a=+e[1],c=+e[2],u=+n[0],l=+n[1],h=+n[2],d=Math.sqrt(u*u+l*l+h*h);if(0===d)throw new Error("Can't raycast along a zero vector");return function(t,e,n,r,i,o,s,a,c,u){for(var l=0,h=Math.floor,d=0|h(e),f=0|h(n),p=0|h(r),v=i>0?1:-1,m=o>0?1:-1,g=s>0?1:-1,y=Math.abs(1/i),_=Math.abs(1/o),b=Math.abs(1/s),k=y<1/0?y*(v>0?d+1-e:e-d):1/0,w=_<1/0?_*(m>0?f+1-n:n-f):1/0,x=b<1/0?b*(g>0?p+1-r:r-p):1/0,M=-1;l<=a;){var C=t(d,f,p);if(C)return c&&(c[0]=e+l*i,c[1]=n+l*o,c[2]=r+l*s),u&&(u[0]=u[1]=u[2]=0,0===M&&(u[0]=-v),1===M&&(u[1]=-m),2===M&&(u[2]=-g)),C;k<w?k<x?(d+=v,l=k,k+=y,M=0):(p+=g,l=x,x+=b,M=2):w<x?(f+=m,l=w,w+=_,M=1):(p+=g,l=x,x+=b,M=2)}return c&&(c[0]=e+l*i,c[1]=n+l*o,c[2]=r+l*s),u&&(u[0]=u[1]=u[2]=0),0}(t,s,a,c,u/=d,l/=d,h/=d,r=void 0===r?64:+r,i,o)}},5984:(t,e,n)=>{var r=n(95),i=n(5602).EventEmitter,o=n(4430);function s(t,e){this.element=t||document,e=e||{},this.preventDefaults=!!e.preventDefaults,this.stopPropagation=!!e.stopPropagation,this.allowContextMenu=!!e.allowContextMenu,this.disabled=!!e.disabled,this.down=new i,this.up=new i,this.state={dx:0,dy:0,scrollx:0,scrolly:0,scrollz:0},this._keybindmap={},this._keyStates={},this._bindPressCounts={},this._ignoreMousemoveOnce=!1,this.initEvents()}function a(t,e,n){g(n.keyCode,r[n.keyCode],e,t,n)}function c(t,e,n){return g(-1-n.button,"<mouse "+(n.button+1)+">",e,t,n),!1}function u(t){if(!t.allowContextMenu)return!1}function l(t,e){if(t._ignoreMousemoveOnce)t._ignoreMousemoveOnce=!1;else{var n=e.movementX||e.mozMovementX||0,r=e.movementY||e.mozMovementY||0;if(e.touches&&0==(n|r)){var i=function(t){for(var e,n=t.changedTouches,r=0;r<n.length;++r)n[r].identifier==f&&(e=n[r]);if(!e)return[0,0];var i=[e.clientX-h,e.clientY-d];return h=e.clientX,d=e.clientY,i}(e);n=i[0],r=i[1]}t.state.dx+=n,t.state.dy+=r}}t.exports=function(t,e){return new s(t,e)},s.prototype.initEvents=function(){window.addEventListener("keydown",a.bind(void 0,this,!0),!1),window.addEventListener("keyup",a.bind(void 0,this,!1),!1),this.element.addEventListener("mousedown",c.bind(void 0,this,!0),!1),this.element.addEventListener("mouseup",c.bind(void 0,this,!1),!1),this.element.oncontextmenu=u.bind(void 0,this),this.element.addEventListener("dragstart",c.bind(void 0,this,!1),!1),this.element.addEventListener("mousemove",l.bind(void 0,this),!1),this.element.addEventListener("touchmove",l.bind(void 0,this),!1),this.element.addEventListener("touchstart",p.bind(void 0,this),!1),o(this.element,v.bind(void 0,this),!1),document.addEventListener("pointerlockchange",m.bind(void 0,this),!1),document.addEventListener("mozpointerlockchange",m.bind(void 0,this),!1)},s.prototype.bind=function(t){for(var e=1;e<arguments.length;++e){var n=arguments[e],r=this._keybindmap[n]||[];-1==r.indexOf(t)&&r.push(t),this._keybindmap[n]=r}this.state[t]=!!this.state[t]},s.prototype.unbind=function(t){for(var e in this._keybindmap){var n=this._keybindmap[e],r=n.indexOf(t);r>-1&&n.splice(r,1)}},s.prototype.tick=function(){this.state.dx=this.state.dy=0,this.state.scrollx=this.state.scrolly=this.state.scrollz=0},s.prototype.getBoundKeys=function(){var t=[];for(var e in this._keybindmap)t.push(e);return t};var h=0,d=0,f=null;function p(t,e){var n=e.changedTouches[0];h=n.clientX,d=n.clientY,f=n.identifier}function v(t,e){var n=1;switch(e.deltaMode){case 0:n=1;break;case 1:n=12;break;case 2:n=t.element.clientHeight||window.innerHeight}return t.state.scrollx+=e.deltaX*n,t.state.scrolly+=e.deltaY*n,t.state.scrollz+=e.deltaZ*n||0,!1}function m(t,e){(document.pointerLockElement||document.mozPointerLockElement)&&(t._ignoreMousemoveOnce=!0)}function g(t,e,n,r,i){var o=r._keybindmap[e];if(o){if(r.preventDefaults&&i.preventDefault(),r.stopPropagation&&i.stopPropagation(),_(r._keyStates[t],n))for(var s=0;s<o.length;++s)y(o[s],n,r,i);r._keyStates[t]=n}}function y(t,e,n,r){var i=n._bindPressCounts[t]||0;if((i+=e?1:-1)<0&&(i=0),n._bindPressCounts[t]=i,_(n.state[t],i)){var o=e?n.down:n.up;n.disabled||o.emit(t,r)}n.state[t]=!!i}function _(t,e){return t?!e:e}},4430:t=>{var e,n,r="";function i(t,i,o,s){t[e](r+i,"wheel"==n?o:function(t){!t&&(t=window.event);var e={originalEvent:t,target:t.target||t.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==t.type?0:1,deltaX:0,delatZ:0,preventDefault:function(){t.preventDefault?t.preventDefault():t.returnValue=!1}};return"mousewheel"==n?(e.deltaY=-1/40*t.wheelDelta,t.wheelDeltaX&&(e.deltaX=-1/40*t.wheelDeltaX)):e.deltaY=t.detail,o(e)},s||!1)}window.addEventListener?e="addEventListener":(e="attachEvent",r="on"),n="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",t.exports=function(t,e,r){i(t,n,e,r),"DOMMouseScroll"==n&&i(t,"MozMousePixelScroll",e,r)}},2885:t=>{t.exports=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}},7566:(t,e,n)=>{t.exports=function(t,e){var n=r(t[0],t[1],t[2]),s=r(e[0],e[1],e[2]);i(n,n),i(s,s);var a=o(n,s);return a>1?0:Math.acos(a)};var r=n(7695),i=n(5083),o=n(894)},7162:t=>{t.exports=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}},6703:t=>{t.exports=function(t){var e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}},7633:t=>{t.exports=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}},6020:t=>{t.exports=function(){var t=new Float32Array(3);return t[0]=0,t[1]=0,t[2]=0,t}},341:t=>{t.exports=function(t,e,n){var r=e[0],i=e[1],o=e[2],s=n[0],a=n[1],c=n[2];return t[0]=i*c-o*a,t[1]=o*s-r*c,t[2]=r*a-i*s,t}},5749:(t,e,n)=>{t.exports=n(6250)},6250:t=>{t.exports=function(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(n*n+r*r+i*i)}},3625:(t,e,n)=>{t.exports=n(5826)},5826:t=>{t.exports=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}},894:t=>{t.exports=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}},4460:t=>{t.exports=1e-6},8849:(t,e,n)=>{t.exports=function(t,e){var n=t[0],i=t[1],o=t[2],s=e[0],a=e[1],c=e[2];return Math.abs(n-s)<=r*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-a)<=r*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(o-c)<=r*Math.max(1,Math.abs(o),Math.abs(c))};var r=n(4460)},8448:t=>{t.exports=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}},5618:t=>{t.exports=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}},1142:(t,e,n)=>{t.exports=function(t,e,n,i,o,s){var a,c;for(e||(e=3),n||(n=0),c=i?Math.min(i*e+n,t.length):t.length,a=n;a<c;a+=e)r[0]=t[a],r[1]=t[a+1],r[2]=t[a+2],o(r,r,s),t[a]=r[0],t[a+1]=r[1],t[a+2]=r[2];return t};var r=n(6020)()},7695:t=>{t.exports=function(t,e,n){var r=new Float32Array(3);return r[0]=t,r[1]=e,r[2]=n,r}},7729:(t,e,n)=>{t.exports={EPSILON:n(4460),create:n(6020),clone:n(6703),angle:n(7566),fromValues:n(7695),copy:n(7633),set:n(1038),equals:n(8849),exactEquals:n(8448),add:n(2885),subtract:n(9332),sub:n(2661),multiply:n(7654),mul:n(5600),divide:n(5826),div:n(3625),min:n(4355),max:n(7774),floor:n(5618),ceil:n(7162),round:n(6578),scale:n(9177),scaleAndAdd:n(3175),distance:n(6250),dist:n(5749),squaredDistance:n(4815),sqrDist:n(6900),length:n(5409),len:n(4066),squaredLength:n(48),sqrLen:n(7643),negate:n(8474),inverse:n(1384),normalize:n(5083),dot:n(894),cross:n(341),lerp:n(9059),random:n(670),transformMat4:n(5769),transformMat3:n(6319),transformQuat:n(7672),rotateX:n(2528),rotateY:n(3319),rotateZ:n(6743),forEach:n(1142)}},1384:t=>{t.exports=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}},4066:(t,e,n)=>{t.exports=n(5409)},5409:t=>{t.exports=function(t){var e=t[0],n=t[1],r=t[2];return Math.sqrt(e*e+n*n+r*r)}},9059:t=>{t.exports=function(t,e,n,r){var i=e[0],o=e[1],s=e[2];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=s+r*(n[2]-s),t}},7774:t=>{t.exports=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}},4355:t=>{t.exports=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}},5600:(t,e,n)=>{t.exports=n(7654)},7654:t=>{t.exports=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}},8474:t=>{t.exports=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}},5083:t=>{t.exports=function(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t}},670:t=>{t.exports=function(t,e){e=e||1;var n=2*Math.random()*Math.PI,r=2*Math.random()-1,i=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*i,t[1]=Math.sin(n)*i,t[2]=r*e,t}},2528:t=>{t.exports=function(t,e,n,r){var i=n[1],o=n[2],s=e[1]-i,a=e[2]-o,c=Math.sin(r),u=Math.cos(r);return t[0]=e[0],t[1]=i+s*u-a*c,t[2]=o+s*c+a*u,t}},3319:t=>{t.exports=function(t,e,n,r){var i=n[0],o=n[2],s=e[0]-i,a=e[2]-o,c=Math.sin(r),u=Math.cos(r);return t[0]=i+a*c+s*u,t[1]=e[1],t[2]=o+a*u-s*c,t}},6743:t=>{t.exports=function(t,e,n,r){var i=n[0],o=n[1],s=e[0]-i,a=e[1]-o,c=Math.sin(r),u=Math.cos(r);return t[0]=i+s*u-a*c,t[1]=o+s*c+a*u,t[2]=e[2],t}},6578:t=>{t.exports=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}},9177:t=>{t.exports=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}},3175:t=>{t.exports=function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}},1038:t=>{t.exports=function(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}},6900:(t,e,n)=>{t.exports=n(4815)},7643:(t,e,n)=>{t.exports=n(48)},4815:t=>{t.exports=function(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}},48:t=>{t.exports=function(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}},2661:(t,e,n)=>{t.exports=n(9332)},9332:t=>{t.exports=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}},6319:t=>{t.exports=function(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t}},5769:t=>{t.exports=function(t,e,n){var r=e[0],i=e[1],o=e[2],s=n[3]*r+n[7]*i+n[11]*o+n[15];return s=s||1,t[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/s,t[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/s,t[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/s,t}},7672:t=>{t.exports=function(t,e,n){var r=e[0],i=e[1],o=e[2],s=n[0],a=n[1],c=n[2],u=n[3],l=u*r+a*o-c*i,h=u*i+c*r-s*o,d=u*o+s*i-a*r,f=-s*r-a*i-c*o;return t[0]=l*u+f*-s+h*-c-d*-a,t[1]=h*u+f*-a+d*-s-l*-c,t[2]=d*u+f*-c+l*-a-h*-s,t}},2161:t=>{"use strict";t.exports=function(t){for(var e=new Array(t),n=0;n<t;++n)e[n]=n;return e}},6773:t=>{function e(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}t.exports=function(t){return null!=t&&(e(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&e(t.slice(0,0))}(t)||!!t._isBuffer)}},4704:(t,e,n)=>{var r=n(2161),i=n(6773),o="undefined"!=typeof Float64Array;function s(t,e){return t[0]-e[0]}function a(){var t,e=this.stride,n=new Array(e.length);for(t=0;t<n.length;++t)n[t]=[Math.abs(e[t]),t];n.sort(s);var r=new Array(n.length);for(t=0;t<r.length;++t)r[t]=n[t][1];return r}function c(t,e){var n=["View",e,"d",t].join("");e<0&&(n="View_Nil"+t);var i="generic"===t;if(-1===e){var o="function "+n+"(a){this.data=a;};var proto="+n+".prototype;proto.dtype='"+t+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+n+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+n+"(a){return new "+n+"(a);}";return new Function(o)()}if(0===e)return o="function "+n+"(a,d) {this.data = a;this.offset = d};var proto="+n+".prototype;proto.dtype='"+t+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+n+"_copy() {return new "+n+"(this.data,this.offset)};proto.pick=function "+n+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+n+"_get(){return "+(i?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+n+"_set(v){return "+(i?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+n+"(a,b,c,d){return new "+n+"(a,d)}",new Function("TrivialArray",o)(u[t][0]);o=["'use strict'"];var s=r(e),c=s.map((function(t){return"i"+t})),l="this.offset+"+s.map((function(t){return"this.stride["+t+"]*i"+t})).join("+"),h=s.map((function(t){return"b"+t})).join(","),d=s.map((function(t){return"c"+t})).join(",");o.push("function "+n+"(a,"+h+","+d+",d){this.data=a","this.shape=["+h+"]","this.stride=["+d+"]","this.offset=d|0}","var proto="+n+".prototype","proto.dtype='"+t+"'","proto.dimension="+e),o.push("Object.defineProperty(proto,'size',{get:function "+n+"_size(){return "+s.map((function(t){return"this.shape["+t+"]"})).join("*"),"}})"),1===e?o.push("proto.order=[0]"):(o.push("Object.defineProperty(proto,'order',{get:"),e<4?(o.push("function "+n+"_order(){"),2===e?o.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===e&&o.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):o.push("ORDER})")),o.push("proto.set=function "+n+"_set("+c.join(",")+",v){"),i?o.push("return this.data.set("+l+",v)}"):o.push("return this.data["+l+"]=v}"),o.push("proto.get=function "+n+"_get("+c.join(",")+"){"),i?o.push("return this.data.get("+l+")}"):o.push("return this.data["+l+"]}"),o.push("proto.index=function "+n+"_index(",c.join(),"){return "+l+"}"),o.push("proto.hi=function "+n+"_hi("+c.join(",")+"){return new "+n+"(this.data,"+s.map((function(t){return["(typeof i",t,"!=='number'||i",t,"<0)?this.shape[",t,"]:i",t,"|0"].join("")})).join(",")+","+s.map((function(t){return"this.stride["+t+"]"})).join(",")+",this.offset)}");var f=s.map((function(t){return"a"+t+"=this.shape["+t+"]"})),p=s.map((function(t){return"c"+t+"=this.stride["+t+"]"}));o.push("proto.lo=function "+n+"_lo("+c.join(",")+"){var b=this.offset,d=0,"+f.join(",")+","+p.join(","));for(var v=0;v<e;++v)o.push("if(typeof i"+v+"==='number'&&i"+v+">=0){d=i"+v+"|0;b+=c"+v+"*d;a"+v+"-=d}");for(o.push("return new "+n+"(this.data,"+s.map((function(t){return"a"+t})).join(",")+","+s.map((function(t){return"c"+t})).join(",")+",b)}"),o.push("proto.step=function "+n+"_step("+c.join(",")+"){var "+s.map((function(t){return"a"+t+"=this.shape["+t+"]"})).join(",")+","+s.map((function(t){return"b"+t+"=this.stride["+t+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil"),v=0;v<e;++v)o.push("if(typeof i"+v+"==='number'){d=i"+v+"|0;if(d<0){c+=b"+v+"*(a"+v+"-1);a"+v+"=ceil(-a"+v+"/d)}else{a"+v+"=ceil(a"+v+"/d)}b"+v+"*=d}");o.push("return new "+n+"(this.data,"+s.map((function(t){return"a"+t})).join(",")+","+s.map((function(t){return"b"+t})).join(",")+",c)}");var m=new Array(e),g=new Array(e);for(v=0;v<e;++v)m[v]="a[i"+v+"]",g[v]="b[i"+v+"]";for(o.push("proto.transpose=function "+n+"_transpose("+c+"){"+c.map((function(t,e){return t+"=("+t+"===undefined?"+e+":"+t+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+n+"(this.data,"+m.join(",")+","+g.join(",")+",this.offset)}"),o.push("proto.pick=function "+n+"_pick("+c+"){var a=[],b=[],c=this.offset"),v=0;v<e;++v)o.push("if(typeof i"+v+"==='number'&&i"+v+">=0){c=(c+this.stride["+v+"]*i"+v+")|0}else{a.push(this.shape["+v+"]);b.push(this.stride["+v+"])}");return o.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),o.push("return function construct_"+n+"(data,shape,stride,offset){return new "+n+"(data,"+s.map((function(t){return"shape["+t+"]"})).join(",")+","+s.map((function(t){return"stride["+t+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",o.join("\n"))(u[t],a)}var u={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};t.exports=function(t,e,n,r){if(void 0===t)return(0,u.array[0])([]);"number"==typeof t&&(t=[t]),void 0===e&&(e=[t.length]);var s=e.length;if(void 0===n){n=new Array(s);for(var a=s-1,l=1;a>=0;--a)n[a]=l,l*=e[a]}if(void 0===r)for(r=0,a=0;a<s;++a)n[a]<0&&(r-=(e[a]-1)*n[a]);for(var h=function(t){if(i(t))return"buffer";if(o)switch(Object.prototype.toString.call(t)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(t)?"array":"generic"}(t),d=u[h];d.length<=s+1;)d.push(c(h,d.length-1));return(0,d[s+1])(t,e,n,r)}},9463:(t,e,n)=>{"use strict";n.d(e,{ZT:()=>i,gn:()=>o});var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function o(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s}Object.create,Object.create},95:t=>{"use strict";var e,n="undefined"!=typeof window?window.navigator.userAgent:"",r=/OS X/.test(n),i=/Opera/.test(n),o=!/like Gecko/.test(n)&&!i,s=t.exports={0:r?"<menu>":"<UNK>",1:"<mouse 1>",2:"<mouse 2>",3:"<break>",4:"<mouse 3>",5:"<mouse 4>",6:"<mouse 5>",8:"<backspace>",9:"<tab>",12:"<clear>",13:"<enter>",16:"<shift>",17:"<control>",18:"<alt>",19:"<pause>",20:"<caps-lock>",21:"<ime-hangul>",23:"<ime-junja>",24:"<ime-final>",25:"<ime-kanji>",27:"<escape>",28:"<ime-convert>",29:"<ime-nonconvert>",30:"<ime-accept>",31:"<ime-mode-change>",32:"<space>",33:"<page-up>",34:"<page-down>",35:"<end>",36:"<home>",37:"<left>",38:"<up>",39:"<right>",40:"<down>",41:"<select>",42:"<print>",43:"<execute>",44:"<snapshot>",45:"<insert>",46:"<delete>",47:"<help>",91:"<meta>",92:"<meta>",93:r?"<meta>":"<menu>",95:"<sleep>",106:"<num-*>",107:"<num-+>",108:"<num-enter>",109:"<num--\x3e",110:"<num-.>",111:"<num-/>",144:"<num-lock>",145:"<scroll-lock>",160:"<shift-left>",161:"<shift-right>",162:"<control-left>",163:"<control-right>",164:"<alt-left>",165:"<alt-right>",166:"<browser-back>",167:"<browser-forward>",168:"<browser-refresh>",169:"<browser-stop>",170:"<browser-search>",171:"<browser-favorites>",172:"<browser-home>",173:r&&o?"-":"<volume-mute>",174:"<volume-down>",175:"<volume-up>",176:"<next-track>",177:"<prev-track>",178:"<stop>",179:"<play-pause>",180:"<launch-mail>",181:"<launch-media-select>",182:"<launch-app 1>",183:"<launch-app 2>",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",223:"<meta>",224:"<meta>",226:"<alt-gr>",229:"<ime-process>",231:i?"`":"<unicode>",246:"<attention>",247:"<crsel>",248:"<exsel>",249:"<erase-eof>",250:"<play>",251:"<zoom>",252:"<no-name>",253:"<pa-1>",254:"<clear>"};for(e=58;e<65;++e)s[e]=String.fromCharCode(e);for(e=48;e<58;++e)s[e]=e-48+"";for(e=65;e<91;++e)s[e]=String.fromCharCode(e);for(e=96;e<106;++e)s[e]="<num-"+(e-96)+">";for(e=112;e<136;++e)s[e]="F"+(e-111)},59:t=>{"use strict";var e=[],n=[],r=[],i=[],o=[],s=[],a=[],c=[],u=[],l=[],h=[],d=[];t.exports=function(t,f,p,v,m,g){for(var y=a,_=u,b=l,k=d,w=0;w<3;w++)y[w]=+p[w],b[w]=+f.max[w],_[w]=+f.base[w];g||(g=1e-10);var x=function(t,a,u,l,d,f){var p=e,v=n,m=r,g=i,y=o,_=s,b=c,k=Math.floor,w=0,x=0,M=0,C=0,P=0;if(T(),0===M)return 0;for(C=j();x<=M;){if(D(C)&&A())return w;C=j()}for(w+=M,P=0;P<3;P++)l[P]+=u[P],d[P]+=u[P];return w;function T(){if(x=0,0!==(M=Math.sqrt(u[0]*u[0]+u[1]*u[1]+u[2]*u[2])))for(var t=0;t<3;t++){var e=u[t]>=0;g[t]=e?1:-1;var n=e?d[t]:l[t];p[t]=e?l[t]:d[t],v[t]=E(n,g[t]),m[t]=I(p[t],g[t]),b[t]=u[t]/M,y[t]=Math.abs(1/b[t]);var r=e?v[t]+1-n:n-v[t];_[t]=y[t]<1/0?y[t]*r:1/0}}function D(e){for(var n=g[0],r=0===e?v[0]:m[0],i=v[0]+n,o=g[1],s=1===e?v[1]:m[1],a=v[1]+o,c=g[2],u=2===e?v[2]:m[2],l=v[2]+c,h=r;h!=i;h+=n)for(var d=s;d!=a;d+=o)for(var f=u;f!=l;f+=c)if(t(h,d,f))return!0;return!1}function A(){w+=x;var t=g[C],e=x/M,n=h;for(P=0;P<3;P++){var r=u[P]*e;l[P]+=r,d[P]+=r,n[P]=u[P]-r}if(t>0?d[C]=Math.round(d[C]):l[C]=Math.round(l[C]),a(w,C,t,n))return!0;for(P=0;P<3;P++)u[P]=n[P];return T(),0===M}function j(){var t=_[0]<_[1]?_[0]<_[2]?0:2:_[1]<_[2]?1:2,e=_[t]-x;for(x=_[t],v[t]+=g[t],_[t]+=y[t],P=0;P<3;P++)p[P]+=e*b[P],m[P]=I(p[P],g[P]);return t}function E(t,e){return k(t-e*f)}function I(t,e){return k(t+e*f)}}(t,v,y,_,b,g);if(!m){for(w=0;w<3;w++)k[w]=p[w]>0?b[w]-f.max[w]:_[w]-f.base[w];f.translate(k)}return x}},6443:(t,e,n)=>{var r=n(6133),i=n(7729);function o(t,e,n,o,s,a,c){this.aabb=new r(t.base,t.vec),this.mass=e,this.friction=n,this.restitution=o,this.gravityMultiplier=s,this.onCollide=a,this.autoStep=!!c,this.airDrag=-1,this.fluidDrag=-1,this.onStep=null,this.velocity=i.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=i.create(),this._impulses=i.create(),this._sleepFrameCount=10}t.exports=o,o.prototype.setPosition=function(t){s(t),i.subtract(t,t,this.aabb.base),this.aabb.translate(t),this._markActive()},o.prototype.getPosition=function(){return i.clone(this.aabb.base)},o.prototype.applyForce=function(t){s(t),i.add(this._forces,this._forces,t),this._markActive()},o.prototype.applyImpulse=function(t){s(t),i.add(this._impulses,this._impulses,t),this._markActive()},o.prototype._markActive=function(){this._sleepFrameCount=10},o.prototype.atRestX=function(){return this.resting[0]},o.prototype.atRestY=function(){return this.resting[1]},o.prototype.atRestZ=function(){return this.resting[2]};var s=function(t){}},8920:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>i});var r=n(9578);function i(t){var e=[];return{name:"collideEntities",order:70,state:{cylinder:!1,collideBits:1,collideMask:1,callback:null},onAdd:null,onRemove:null,system:function(i,o){for(var s=t.ents,a=0;a<o.length;a++){var c=o[a].__id,u=s.getPositionData(c);e[a]=u._extents}e.length=o.length,r(e,(function(r,i){var s=o[r],a=o[i];s&&a&&function(t,e,r,i){return t.cylinder?e.cylinder?function(t,e){var n=(t[3]-t[0])/2,r=(e[3]-e[0])/2,i=t[0]+n-(e[0]+r),o=t[2]+n-(e[2]+r),s=n+r;return i*i+o*o<=s*s}(r,i):n(r,i):!e.cylinder||n(i,r)}(s,a,e[r],e[i])&&function(t,e,n){var r=e.__id,i=n.__id;e.collideMask&n.collideBits&&e.callback&&e.callback(i),n.collideMask&e.collideBits&&n.callback&&n.callback(r),t.ents.onPairwiseEntityCollision(r,i)}(t,s,a)}))}};function n(t,e){var n=(t[3]-t[0])/2,r=t[0]+n,o=t[2]+n,s=i(r,e[0],e[3])-r,a=i(o,e[2],e[5])-o;return s*s+a*a<=n*n}function i(t,e,n){return t<e?e:t>n?n:t}}},9331:(t,e,n)=>{"use strict";function r(t){return{name:"collideTerrain",order:0,state:{callback:null},onAdd:function(e,n){var r=t.entities;r.hasPhysics(e)&&(r.getPhysics(e).body.onCollide=function(n){var r=t.ents.getCollideTerrain(e).callback;r&&r(n,e)})},onRemove:function(e,n){var r=t.entities;r.hasPhysics(e)&&(r.getPhysics(e).body.onCollide=null)}}}n.r(e),n.d(e,{default:()=>r})},315:(t,e,n)=>{"use strict";function r(t){return{name:"fadeOnZoom",order:99,state:{cutoff:1.5,_showing:null},onAdd:null,onRemove:null,system:function(e,n){for(var r=t.camera.currentZoom,o=t.entities,s=0;s<n.length;s++)i(n[s],r,o)}}}function i(t,e,n){if(n.hasMesh(t.__id)){var r=e>t.cutoff;t._showing!==r&&(n.getMeshData(t.__id).mesh.visibility=r,t._showing=r)}}n.r(e),n.d(e,{default:()=>r})},1622:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>o});var r=n(7729),i=n.n(r);function o(t){return{name:"followsEntity",order:50,state:{entity:0,offset:null,onTargetMissing:null},onAdd:function(t,r){var o=i().create();r.offset=r.offset?i().copy(o,r.offset):o,e(r),n(r)},onRemove:null,system:function(t,n){for(var r=0;r<n.length;r++)e(n[r])},renderSystem:function(t,e){for(var r=0;r<e.length;r++)n(e[r])}};function e(e){var n=e.__id,r=t.ents.getPositionData(n),o=t.ents.getPositionData(e.entity);o?i().add(r._localPosition,o._localPosition,e.offset):(e.onTargetMissing&&e.onTargetMissing(n),t.ents.removeComponent(n,t.ents.names.followsEntity))}function n(e){var n=e.__id,r=t.ents.getPositionData(n),o=t.ents.getPositionData(e.entity);o&&i().add(r._renderPosition,o._renderPosition,e.offset)}}},7668:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>o});var r=n(7729),i=n.n(r);function o(t){return{name:"mesh",order:100,state:{mesh:null,offset:null},onAdd:function(e,n){var r=t.ents.getPositionData(e);if(!n.mesh)throw new Error("Mesh component added without a mesh - probably a bug!");t.rendering.addMeshToScene(n.mesh,!1,r.position),n.offset||(n.offset=i().create());var o=r._renderPosition;n.mesh.position.copyFromFloats(o[0]+n.offset[0],o[1]+n.offset[1],o[2]+n.offset[2])},onRemove:function(t,e){e.mesh.dispose()},renderSystem:function(e,n){for(var r=0;r<n.length;r++){var i=n[r],o=i.__id,s=t.ents.getPositionData(o)._renderPosition;i.mesh.position.copyFromFloats(s[0]+i.offset[0],s[1]+i.offset[1],s[2]+i.offset[2])}}}}},892:(t,e,n)=>{"use strict";n.r(e),n.d(e,{MovementState:()=>o,default:()=>s});var r=n(7729),i=n.n(r);function o(){this.heading=0,this.running=!1,this.jumping=!1,this.maxSpeed=10,this.moveForce=30,this.responsiveness=15,this.runningFriction=0,this.standingFriction=2,this.airMoveMult=.5,this.jumpImpulse=10,this.jumpForce=12,this.jumpTime=500,this.airJumps=1,this._jumpCount=0,this._currjumptime=0,this._isJumping=!1}function s(t){return{name:"movement",order:30,state:new o,onAdd:null,onRemove:null,system:function(e,n){for(var r=t.entities,i=0;i<n.length;i++){var o=n[i],s=r.getPhysics(o.__id);s&&l(e,o,s.body)}}}}var a=i().create(),c=i().create(),u=i().create();function l(t,e,n){var r=n.atRestY()<0,o=r||e._jumpCount<e.airJumps;if(r&&(e._isJumping=!1,e._jumpCount=0),e.jumping)if(e._isJumping){if(e._currjumptime>0){var s=e.jumpForce;e._currjumptime<t&&(s*=e._currjumptime/t),n.applyForce([0,s,0]),e._currjumptime-=t}}else o&&(e._isJumping=!0,r||e._jumpCount++,e._currjumptime=e.jumpTime,n.applyImpulse([0,e.jumpImpulse,0]),!r&&n.velocity[1]<0&&(n.velocity[1]=0));else e._isJumping=!1;var l=a,h=c;if(e.running){var d=e.maxSpeed;i().set(l,0,0,d),i().rotateY(l,l,u,e.heading),i().subtract(h,l,n.velocity),h[1]=0;var f=i().length(h);if(i().normalize(h,h),f>0){var p=e.moveForce;r||(p*=e.airMoveMult);var v=e.responsiveness*f;p>v&&(p=v),i().scale(h,h,p),n.applyForce(h)}n.friction=e.runningFriction}else n.friction=e.standingFriction}},3706:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>o,setPhysicsFromPosition:()=>a});var r=n(7729),i=n.n(r);function o(t){return{name:"physics",order:40,state:{body:null},onAdd:function(e,n){n.body=t.physics.addBody(),a(n,t.ents.getPositionData(n.__id))},onRemove:function(e,n){if(t.ents.hasPosition(n.__id)){var r=t.ents.getPositionData(n.__id);c(n,r),u(n,r,0,!1)}t.physics.removeBody(n.body)},system:function(e,n){for(var r=0;r<n.length;r++){var i=n[r];c(i,t.ents.getPositionData(i.__id))}},renderSystem:function(e,n){for(var r=t.positionInCurrentTick,i=1e3/t.container._shell.tickRate,o=(r*i-i)/1e3,s=0;s<n.length;s++){var a=n[s],c=a.__id;u(a,t.ents.getPositionData(c),o,t.ents.cameraSmoothed(c))}}}}var s=i().create();function a(t,e){var n=t.body.aabb,r=e._extents;i().copy(n.base,r),i().set(n.vec,e.width,e.height,e.width),i().add(n.max,n.base,n.vec)}function c(t,e){var n=t.body.aabb.base,r=e.width/2;i().set(e._localPosition,n[0]+r,n[1],n[2]+r)}function u(t,e,n,r){var o=t.body.velocity;i().scaleAndAdd(s,e._localPosition,o,n),r&&i().lerp(s,e._renderPosition,s,.3),i().copy(e._renderPosition,s)}},7538:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>o,updatePositionExtents:()=>s});var r=n(7729),i=n.n(r);function o(t){return{name:"position",order:60,state:{position:null,width:.8,height:.8,_localPosition:null,_renderPosition:null,_extents:null},onAdd:function(e,n){var r=[0,0,0];n.position&&i().copy(r,n.position),n.position=r,n._localPosition=i().create(),n._renderPosition=i().create(),n._extents=new Float32Array(6),t.globalToLocal(n.position,null,n._localPosition),i().copy(n._renderPosition,n._localPosition),s(n)},onRemove:null,system:function(e,n){for(var r=t.worldOriginOffset,o=0;o<n.length;o++){var a=n[o];i().add(a.position,a._localPosition,r),s(a)}}}}function s(t){var e=t.width/2,n=t._localPosition,r=t._extents;r[0]=n[0]-e,r[1]=n[1],r[2]=n[2]-e,r[3]=n[0]+e,r[4]=n[1]+t.height,r[5]=n[2]+e}},7717:(t,e,n)=>{"use strict";function r(t){return{name:"receivesInputs",order:20,state:{},onAdd:null,onRemove:null,system:function(e,n){for(var r=t.entities,o=t.inputs.state,s=t.camera.heading,a=0;a<n.length;a++){var c=n[a];i(r.getMovement(c.__id),o,s)}}}}function i(t,e,n){t.jumping=!!e.jump;var r=e.forward?e.backward?0:1:e.backward?-1:0,i=e.right?e.left?0:1:e.left?-1:0;0==(r|i)?t.running=!1:(t.running=!0,r?(-1==r&&(n+=Math.PI),i&&(n+=Math.PI/4*r*i)):n+=i*Math.PI/2,t.heading=n)}n.r(e),n.d(e,{default:()=>r})},5260:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>a});var r=n(7729),i=n.n(r),o=n(6149),s=n(8545);function a(t,e){var n=e,r=t.rendering.getScene(),i=s.Kj.CreateDisc("shadow",.75,30,r);i.rotation.x=Math.PI/2;var a=t.rendering.makeStandardMaterial("shadowMat");return a.diffuseColor=o.Wo.Black(),a.ambientColor=o.Wo.Black(),a.alpha=.5,i.material=a,i.setEnabled(!1),r.removeMesh(i),{name:"shadow",order:80,state:{size:.5,_mesh:null},onAdd:function(e,n){var r=i.createInstance("shadow_instance");t.rendering.addMeshToScene(r),r.setEnabled(!1),n._mesh=r},onRemove:function(t,e){e._mesh.dispose()},system:function(e,r){for(var i=t.camera._localGetPosition(),o=n,s=0;s<r.length;s++){var a=r[s],c=t.ents.getPositionData(a.__id),u=t.ents.getPhysics(a.__id);l(t,c,u,a._mesh,a.size,o,i)}},renderSystem:function(e,n){for(var r=0;r<n.length;r++){var i=n[r],o=t.ents.getPositionData(i.__id)._renderPosition,s=i._mesh.position;s.x=o[0],s.z=o[2]}}}}n(3306),n(9004);var c=i().fromValues(0,0,0),u=i().fromValues(0,-1,0);function l(t,e,n,r,o,s,a){var l;if(n&&n.body.resting[1]<0)l=e._localPosition[1];else{var h=t._localPick(e._localPosition,u,s);if(!h)return void r.setEnabled(!1);l=h.position[1]-t.worldOriginOffset[1]}l=Math.round(l),i().copy(c,e._localPosition),c[1]=l;var d=.01+i().squaredDistance(a,c)/1600*.1;d>.1&&(d=.1),r.position.y=l+d;var f=.7*o*(1-(e._localPosition[1]-l)/s);r.scaling.copyFromFloats(f,f,f),r.setEnabled(!0)}},4455:(t,e,n)=>{"use strict";function r(t){return{name:"smooth-camera",order:99,state:{time:100.1},onAdd:null,onRemove:null,system:function(e,n){for(var r=0;r<n.length;r++){var i=n[r];i.time-=e,i.time<0&&t.ents.removeComponent(i.__id,"smooth-camera")}}}}n.r(e),n.d(e,{default:()=>r})},1791:(t,e,n)=>{var r={"./collideEntities.js":8920,"./collideTerrain.js":9331,"./fadeOnZoom.js":315,"./followsEntity.js":1622,"./mesh.js":7668,"./movement.js":892,"./physics.js":3706,"./position.js":7538,"./receivesInputs.js":7717,"./shadow.js":5260,"./smoothCamera.js":4455};function i(t){var e=o(t);return n(e)}function o(t){if(!n.o(r,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return r[t]}i.keys=function(){return Object.keys(r)},i.resolve=o,t.exports=i,i.id=1791},7794:(t,e,n)=>{"use strict";function r(t,e){var n=t.indexOf(e);n<0||(n===t.length-1?t.pop():t[n]=t.pop())}function i(t,e,n){var r=n||performance.now();if(!e()){var i=performance.now(),o=r+t-(i-n)/2;if(!(i>o))for(var s=0;s<1e3;s++)if(e()||performance.now()>o)return}}function o(t,e,n,r,i){t?function(t,e,n,r,i,o,s,a,c,u,l){for(var h=t.stride[2],d=e.stride[2],f=0;f<o;f++)for(var p=0;p<s;p++)for(var v=t.index(n+f,r+p,i),m=e.index(c+f,u+p,l),g=0;g<a;g++)e.data[m]=t.data[v],v+=h,m+=d}(t,e,n[0],n[1],n[2],r[0],r[1],r[2],i[0],i[1],i[2]):function(t,e,n,r,i,o,s){for(var a=t.stride[2],c=0;c<i;c++)for(var u=0;u<o;u++)for(var l=t.index(e+c,n+u,r),h=0;h<s;h++)t.data[l]=0,l+=a}(e,i[0],i[1],i[2],r[0],r[1],r[2])}function s(t,e,n,r){if(0===t)return r(0,0,0);var i=Math.min(t,e),o=Math.min(t,n);if(t<=n)for(var s=-i;s<=i;s++)for(var a=-i;a<=i;a++){if(r(s,t,a))return!0;if(r(s,-t,a))return!0}if(t<=e)for(var c=-t;c<t;c++)for(var u=1-o;u<o;u++){if(r(c,u,t))return!0;if(r(-c,u,-t))return!0;if(r(t,u,-c))return!0;if(r(-t,u,c))return!0}return!1}function a(t,e,n){return 1023&t|(1023&e)<<10|(1023&n)<<20}function c(){var t={};this.getChunkByIndexes=(e,n,r)=>t[a(e,n,r)]||null,this.storeChunkByIndexes=(e,n,r,i)=>{t[a(e,n,r)]=i},this.removeChunkByIndexes=(e,n,r)=>{delete t[a(e,n,r)]}}function u(){this.arr=[],this.hash={}}function l(t,e,n){if(!(t>0))return()=>{};e=e||"";var r=[],i=[],o=0,s=0,a=0,c=0,u=!0;return function(l){"start"===l?(u&&(r.length=i.length=0,u=!1),o=s=performance.now(),a++):"end"===l?function(){if(c+=performance.now()-o,a===t){var s=e+" total "+(c/t).toFixed(2)+"ms (avg, "+t+" runs)    ";console.log(s,i.map((function(e,i){return n&&r[i]/c<.05?"":e+": "+(r[i]/t).toFixed(2)+"ms    "})).join("")),u=!0,a=0,c=0}}():function(t){var e=performance.now();i.indexOf(t)<0&&i.push(t);var n=i.indexOf(t);r[n]||(r[n]=0),r[n]+=e-s,s=e}(l)}}n.d(e,{xP:()=>r,KV:()=>i,Fx:()=>o,fh:()=>s,wX:()=>a,dM:()=>c,l3:()=>u,hv:()=>l}),u.prototype.forEach=function(t,e){this.arr.forEach(t,e)},u.prototype.includes=function(t,e,n){var r=a(t,e,n);return!!this.hash[r]},u.prototype.add=function(t,e,n){var r=a(t,e,n);this.hash[r]||(this.arr.push([t,e,n,r]),this.hash[r]=!0)},u.prototype.removeByIndex=function(t){var e=this.arr[t];delete this.hash[e[3]],this.arr.splice(t,1)},u.prototype.remove=function(t,e,n){var r=a(t,e,n);if(this.hash[r]){delete this.hash[r];for(var i=0;i<this.arr.length;i++)if(r===this.arr[i][3])return void this.arr.splice(i,1);throw"internal bug with location queue - hash value overlapped"}},u.prototype.count=function(){return this.arr.length},u.prototype.isEmpty=function(){return 0===this.arr.length},u.prototype.empty=function(){this.arr.length=0,this.hash={}},u.prototype.pop=function(){var t=this.arr.pop();return delete this.hash[t[3]],t},u.prototype.copyFrom=function(t){for(var e in this.arr=t.arr.slice(),this.hash={},t.hash)this.hash[e]=!0},u.prototype.sortByDistance=function(t){var e={};for(var n of this.arr)e[n]=t(n);this.arr.sort(((t,n)=>e[n]-e[t])),e=null}}},n={};function r(t){var i=n[t];if(void 0!==i)return i.exports;var o=n[t]={exports:{}};return e[t](o,o.exports,r),o.exports}r.m=e,t=[],r.O=(e,n,i,o)=>{if(!n){var s=1/0;for(u=0;u<t.length;u++){for(var[n,i,o]=t[u],a=!0,c=0;c<n.length;c++)(!1&o||s>=o)&&Object.keys(r.O).every((t=>r.O[t](n[c])))?n.splice(c--,1):(a=!1,o<s&&(s=o));a&&(t.splice(u--,1),e=i())}return e}o=o||0;for(var u=t.length;u>0&&t[u-1][2]>o;u--)t[u]=t[u-1];t[u]=[n,i,o]},r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t={179:0};r.O.j=e=>0===t[e];var e=(e,n)=>{var i,o,[s,a,c]=n,u=0;for(i in a)r.o(a,i)&&(r.m[i]=a[i]);if(c)var l=c(r);for(e&&e(n);u<s.length;u++)o=s[u],r.o(t,o)&&t[o]&&t[o][0](),t[s[u]]=0;return r.O(l)},n=self.webpackChunk=self.webpackChunk||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})();var i=r.O(void 0,[836],(()=>r(4407)));i=r.O(i)})();
//# sourceMappingURL=bundle.js.map